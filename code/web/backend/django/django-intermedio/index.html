<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Apuntes de fácil acceso para distintas tecnologías."><link href=https://crisconru.github.io/code/web/backend/django/django-intermedio/ rel=canonical><meta name=author content="Cristóbal Contreras Rubio"><meta name=lang:clipboard.copy content="Copiar al portapapeles"><meta name=lang:clipboard.copied content="Copiado al portapapeles"><meta name=lang:search.language content=es><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No se encontraron documentos"><meta name=lang:search.result.one content="1 documento encontrado"><meta name=lang:search.result.other content="# documentos encontrados"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Intermedio - Tips de Cristo</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#4caf50><script src=../../../../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=green data-md-color-accent=pink> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#django-intermedio tabindex=1 class=md-skip> Saltar a contenido </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://crisconru.github.io/ title="Tips de Cristo" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Tips de Cristo </span> <span class=md-header-nav__topic> Intermedio </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Búsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Teclee para comenzar búsqueda </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/crisconru/tips title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> crisconru/tips </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://crisconru.github.io/ title="Tips de Cristo" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Tips de Cristo </label> <div class=md-nav__source> <a href=https://github.com/crisconru/tips title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> crisconru/tips </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=Contenido class=md-nav__link> Contenido </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> Devops </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-1 type=checkbox id=nav-2-1-1> <label class=md-nav__link for=nav-2-1-1> Ansible </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-1> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/ansible/ansible/ title=Ansible class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../../../../devops/ansible/inventario/ title=Inventario class=md-nav__link> Inventario </a> </li> <li class=md-nav__item> <a href=../../../../devops/ansible/comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> <li class=md-nav__item> <a href=../../../../devops/ansible/configuracion/ title=Configuracion class=md-nav__link> Configuracion </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-1-5 type=checkbox id=nav-2-1-1-5> <label class=md-nav__link for=nav-2-1-1-5> Playbooks </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-1-1-5> Playbooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/ansible/playbook/playbook/ title=Playbook class=md-nav__link> Playbook </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-2 type=checkbox id=nav-2-1-2> <label class=md-nav__link for=nav-2-1-2> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-2> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/docker/docker-aclaraciones/ title=Aclaraciones class=md-nav__link> Aclaraciones </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-instalacion/ title=Instalación class=md-nav__link> Instalación </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-hub/ title="Docker Hub" class=md-nav__link> Docker Hub </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-comandos/ title="Comandos docker" class=md-nav__link> Comandos docker </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-contenedores/ title="Lanzar contenedores" class=md-nav__link> Lanzar contenedores </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-imagenes/ title="Crear imágenes" class=md-nav__link> Crear imágenes </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-dockerfile/ title=Dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-volumes/ title=Volumes class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-network/ title=Network class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../../../../devops/docker/docker-dockercompose/ title="Docker Compose" class=md-nav__link> Docker Compose </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-3 type=checkbox id=nav-2-1-3> <label class=md-nav__link for=nav-2-1-3> ELK </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-3> ELK </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/elk/elk/ title=ELK class=md-nav__link> ELK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../devops/git/git-git/ title=Git class=md-nav__link> Git </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-5 type=checkbox id=nav-2-1-5> <label class=md-nav__link for=nav-2-1-5> Git Flow </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-5> Git Flow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/git/gitflow/gitflow-gitflow/ title="Git Flow" class=md-nav__link> Git Flow </a> </li> <li class=md-nav__item> <a href=../../../../devops/git/gitflow/gitflow-instalacion/ title="Puesta a punto" class=md-nav__link> Puesta a punto </a> </li> <li class=md-nav__item> <a href=../../../../devops/git/gitflow/gitflow-comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> IDEs </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> IDEs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ides/vscode/vscode/ title="Visual Studio code" class=md-nav__link> Visual Studio code </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Python </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-1 type=checkbox id=nav-2-3-1> <label class=md-nav__link for=nav-2-3-1> Entornos virtuales </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-1> Entornos virtuales </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/venv/venv-introduccion/ title=Introducción class=md-nav__link> Introducción </a> </li> <li class=md-nav__item> <a href=../../../../python/venv/venv-virtualenv/ title=virtualenv class=md-nav__link> virtualenv </a> </li> <li class=md-nav__item> <a href=../../../../python/venv/venv-virtualenvwrapper/ title=virtualenvwrapper class=md-nav__link> virtualenvwrapper </a> </li> <li class=md-nav__item> <a href=../../../../python/venv/venv-pipenv/ title=pipenv class=md-nav__link> pipenv </a> </li> <li class=md-nav__item> <a href=../../../../python/venv/venv-pyenv/ title=pyenv class=md-nav__link> pyenv </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../python/python-pythonpath/ title=PYTHONPATH class=md-nav__link> PYTHONPATH </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4 checked> <label class=md-nav__link for=nav-2-4> Web </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../frontend/html/html-indice/ title=HTML class=md-nav__link> HTML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1-2 type=checkbox id=nav-2-4-1-2> <label class=md-nav__link for=nav-2-4-1-2> CSS </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-4-1-2> CSS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../frontend/css/css-plugins/ title=Plugins class=md-nav__link> Plugins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../frontend/js/js-indice/ title=JS class=md-nav__link> JS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-2 type=checkbox id=nav-2-4-2 checked> <label class=md-nav__link for=nav-2-4-2> Backend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-2> Backend </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-2-1 type=checkbox id=nav-2-4-2-1 checked> <label class=md-nav__link for=nav-2-4-2-1> Django </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-4-2-1> Django </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../django/ title=Django class=md-nav__link> Django </a> </li> <li class=md-nav__item> <a href=../django-principiante/ title=Principiante class=md-nav__link> Principiante </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Intermedio </label> <a href=./ title=Intermedio class="md-nav__link md-nav__link--active"> Intermedio </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#relacion-entre-modelos title="Relación entre modelos" class=md-nav__link> Relación entre modelos </a> </li> <li class=md-nav__item> <a href=#personalizar-el-admin title="Personalizar el Admin" class=md-nav__link> Personalizar el Admin </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#anadir-mas-columnas title="Añadir más columnas" class=md-nav__link> Añadir más columnas </a> </li> <li class=md-nav__item> <a href=#ordenar-columnas title="Ordenar columnas" class=md-nav__link> Ordenar columnas </a> </li> <li class=md-nav__item> <a href=#formulario-de-busqueda title="Formulario de búsqueda" class=md-nav__link> Formulario de búsqueda </a> </li> <li class=md-nav__item> <a href=#campos-con-fechas title="Campos con fechas" class=md-nav__link> Campos con fechas </a> </li> <li class=md-nav__item> <a href=#filtros-de-busqueda title="Filtros de búsqueda" class=md-nav__link> Filtros de búsqueda </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#crear-campos-propios-para-los-filtros title="Crear campos propios para los filtros" class=md-nav__link> Crear campos propios para los filtros </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ejemplo-con-todo title="Ejemplo con todo" class=md-nav__link> Ejemplo con todo </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#filtros-opciones-en-los-template-tags title="Filtros / opciones en los template tags" class=md-nav__link> Filtros / opciones en los template tags </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#formatear-fechas title="Formatear fechas" class=md-nav__link> Formatear fechas </a> </li> <li class=md-nav__item> <a href=#anadir-saltos-de-linea title="Añadir saltos de línea" class=md-nav__link> Añadir saltos de línea </a> </li> <li class=md-nav__item> <a href=#bucles-for-primera-y-ultima-iteracion title="Bucles for - primera y última iteración" class=md-nav__link> Bucles for - primera y última iteración </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pasar-parametros-a-las-vistas title="Pasar parámetros a las vistas" class=md-nav__link> Pasar parámetros a las vistas </a> </li> <li class=md-nav__item> <a href=#buscar-inversamente-en-relaciones title="Buscar inversamente en relaciones" class=md-nav__link> Buscar inversamente en relaciones </a> </li> <li class=md-nav__item> <a href=#procesador-de-contexto title="Procesador de contexto" class=md-nav__link> Procesador de contexto </a> </li> <li class=md-nav__item> <a href=#template-tags-propios title="Template Tags propios" class=md-nav__link> Template Tags propios </a> </li> <li class=md-nav__item> <a href=#ordenacion-directa-de-paginas title="Ordenación directa de páginas" class=md-nav__link> Ordenación directa de páginas </a> </li> <li class=md-nav__item> <a href=#edicion-directa-de-paginas title="Edición directa de páginas" class=md-nav__link> Edición directa de páginas </a> </li> <li class=md-nav__item> <a href=#editor-wysiwyg-en-el-admin title="Editor WYSIWYG en el Admin" class=md-nav__link> Editor WYSIWYG en el Admin </a> </li> <li class=md-nav__item> <a href=#formularios title=Formularios class=md-nav__link> Formularios </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#maquetar-formulario title="Maquetar formulario" class=md-nav__link> Maquetar formulario </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#enviar-emails title="Enviar emails" class=md-nav__link> Enviar emails </a> </li> <li class=md-nav__item> <a href=#grupos-usuarios-y-permisos title="Grupos, Usuarios y permisos" class=md-nav__link> Grupos, Usuarios y permisos </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../django-avanzado/ title=Avanzado class=md-nav__link> Avanzado </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Software </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Software </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sw/linux/linux-fecha-hora/ title="Fecha y Hora" class=md-nav__link> Fecha y Hora </a> </li> <li class=md-nav__item> <a href=../../../../../sw/linux/linux-ficheros/ title=Ficheros class=md-nav__link> Ficheros </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Redes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Redes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sw/redes/redes-linux/ title=Linux class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../../../../sw/redes/redes-ssh/ title=SSH class=md-nav__link> SSH </a> </li> <li class=md-nav__item> <a href=../../../../../sw/redes/redes-iptables/ title=iptables class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=../../../../../sw/redes/redes-ipv6/ title=IPv6 class=md-nav__link> IPv6 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Terminal </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Terminal </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sw/terminal/terminal-bash/ title=Bash class=md-nav__link> Bash </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3-2 type=checkbox id=nav-3-3-2> <label class=md-nav__link for=nav-3-3-2> tmux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-3-2> tmux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sw/terminal/tmux/tmux-comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> <li class=md-nav__item> <a href=../../../../../sw/terminal/tmux/tmux-customizar/ title=Customización class=md-nav__link> Customización </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../sw/terminal/terminal-zsh/ title=ZSH class=md-nav__link> ZSH </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Hardware </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hw/upython/upython-informacion/ title=Micropython class=md-nav__link> Micropython </a> </li> <li class=md-nav__item> <a href=../../../../../hw/pio/pio-informacion/ title=Platformio class=md-nav__link> Platformio </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> IoT </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> IoT </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> MQTT </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> MQTT </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../iot/mqtt/mqtt/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../../../../../iot/mqtt/mqtt-hello-world/ title="Hola mundo" class=md-nav__link> Hola mundo </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#relacion-entre-modelos title="Relación entre modelos" class=md-nav__link> Relación entre modelos </a> </li> <li class=md-nav__item> <a href=#personalizar-el-admin title="Personalizar el Admin" class=md-nav__link> Personalizar el Admin </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#anadir-mas-columnas title="Añadir más columnas" class=md-nav__link> Añadir más columnas </a> </li> <li class=md-nav__item> <a href=#ordenar-columnas title="Ordenar columnas" class=md-nav__link> Ordenar columnas </a> </li> <li class=md-nav__item> <a href=#formulario-de-busqueda title="Formulario de búsqueda" class=md-nav__link> Formulario de búsqueda </a> </li> <li class=md-nav__item> <a href=#campos-con-fechas title="Campos con fechas" class=md-nav__link> Campos con fechas </a> </li> <li class=md-nav__item> <a href=#filtros-de-busqueda title="Filtros de búsqueda" class=md-nav__link> Filtros de búsqueda </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#crear-campos-propios-para-los-filtros title="Crear campos propios para los filtros" class=md-nav__link> Crear campos propios para los filtros </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ejemplo-con-todo title="Ejemplo con todo" class=md-nav__link> Ejemplo con todo </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#filtros-opciones-en-los-template-tags title="Filtros / opciones en los template tags" class=md-nav__link> Filtros / opciones en los template tags </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#formatear-fechas title="Formatear fechas" class=md-nav__link> Formatear fechas </a> </li> <li class=md-nav__item> <a href=#anadir-saltos-de-linea title="Añadir saltos de línea" class=md-nav__link> Añadir saltos de línea </a> </li> <li class=md-nav__item> <a href=#bucles-for-primera-y-ultima-iteracion title="Bucles for - primera y última iteración" class=md-nav__link> Bucles for - primera y última iteración </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pasar-parametros-a-las-vistas title="Pasar parámetros a las vistas" class=md-nav__link> Pasar parámetros a las vistas </a> </li> <li class=md-nav__item> <a href=#buscar-inversamente-en-relaciones title="Buscar inversamente en relaciones" class=md-nav__link> Buscar inversamente en relaciones </a> </li> <li class=md-nav__item> <a href=#procesador-de-contexto title="Procesador de contexto" class=md-nav__link> Procesador de contexto </a> </li> <li class=md-nav__item> <a href=#template-tags-propios title="Template Tags propios" class=md-nav__link> Template Tags propios </a> </li> <li class=md-nav__item> <a href=#ordenacion-directa-de-paginas title="Ordenación directa de páginas" class=md-nav__link> Ordenación directa de páginas </a> </li> <li class=md-nav__item> <a href=#edicion-directa-de-paginas title="Edición directa de páginas" class=md-nav__link> Edición directa de páginas </a> </li> <li class=md-nav__item> <a href=#editor-wysiwyg-en-el-admin title="Editor WYSIWYG en el Admin" class=md-nav__link> Editor WYSIWYG en el Admin </a> </li> <li class=md-nav__item> <a href=#formularios title=Formularios class=md-nav__link> Formularios </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#maquetar-formulario title="Maquetar formulario" class=md-nav__link> Maquetar formulario </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#enviar-emails title="Enviar emails" class=md-nav__link> Enviar emails </a> </li> <li class=md-nav__item> <a href=#grupos-usuarios-y-permisos title="Grupos, Usuarios y permisos" class=md-nav__link> Grupos, Usuarios y permisos </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=django-intermedio>Django Intermedio<a class=headerlink href=#django-intermedio title="Permanent link">&para;</a></h1> <p>TODO:</p> <h2 id=relacion-entre-modelos>Relación entre modelos<a class=headerlink href=#relacion-entre-modelos title="Permanent link">&para;</a></h2> <p>Los modelos se pueden conectar, a través de las claves foráneas, con dos tipos de relaciones:</p> <ul> <li>One-To-Many -&gt; Uno a muchos<ul> <li>Relacionas un campo de una tabla con varias tablas.</li> </ul> </li> <li>Many-To-Many -&gt; Machos a muchos<ul> <li>Relacionas varios campos de una tabla con varias tablas.</li> </ul> </li> </ul> <p>Ejemplo de una one-to-many con el proyecto anterior. Creamos una app <code class=codehilite><span class=n>blog</span></code> que va a contener dos modelos, uno categoría y otro post:</p> <ul> <li>Cada post solo tiene un autor, pero cada autor (usuario) puede tener varias entradas (one-to-many).<ul> <li>Si se elimina a un autor, se deben de eliminar todos sus post (en cascada).</li> <li>Cuando la relación es one-to-many se usa un campo <code class=codehilite><span class=n>ForeignKey</span></code> (clave foránea).</li> <li>La relación one-to-many es <code class=codehilite><span class=k>User</span></code>-<code class=codehilite><span class=n>Post</span></code>.</li> </ul> </li> <li>Cada post podrá tener varias categorías, y cada categoría puede estar en varios post (many-to-many).<ul> <li>Cuando la relación es many-to-many se usa un campo <code class=codehilite><span class=n>ManyToManyField</span></code></li> <li>La relación many-to-many es <code class=codehilite><span class=n>Category</span></code>-<code class=codehilite><span class=n>Post</span></code>.</li> </ul> </li> </ul> <p>Así que el <code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code> quedaría</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
<span class=kn>from</span> <span class=nn>django.utils.timezone</span> <span class=kn>import</span> <span class=n>now</span>
<span class=kn>from</span> <span class=nn>django.contrib.auth.models</span> <span class=kn>import</span> <span class=n>User</span>


<span class=c1># Create your models here.</span>
<span class=k>class</span> <span class=nc>Category</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Nombre&#39;</span><span class=p>)</span>
    <span class=n>created</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Creado&#39;</span><span class=p>)</span>
    <span class=n>updated</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Actualizado&#39;</span><span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>verbose_name</span> <span class=o>=</span> <span class=s1>&#39;categoría&#39;</span>
        <span class=n>verbose_name_plural</span> <span class=o>=</span> <span class=s1>&#39;categorias&#39;</span>
        <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;-created&#39;</span><span class=p>]</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>


<span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Título&#39;</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>)</span>
    <span class=n>published</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=n>now</span><span class=p>,</span>
                                     <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Publicado&#39;</span><span class=p>)</span>
    <span class=n>image</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ImageField</span><span class=p>(</span><span class=n>upload_to</span><span class=o>=</span><span class=s1>&#39;blog&#39;</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>blank</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                              <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Imagen&#39;</span><span class=p>)</span>
    <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>User</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span>
                               <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Autor&#39;</span><span class=p>)</span>
    <span class=n>categories</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=n>Category</span><span class=p>,</span> <span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;get_posts&#39;</span><span class=p>,</span>
                                        <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Categorías&#39;</span><span class=p>)</span>
    <span class=n>created</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Creado&#39;</span><span class=p>)</span>
    <span class=n>updated</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Actualizado&#39;</span><span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>verbose_name</span> <span class=o>=</span> <span class=s1>&#39;entrada&#39;</span>
        <span class=n>verbose_name_plural</span> <span class=o>=</span> <span class=s1>&#39;entradas&#39;</span>
        <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;-created&#39;</span><span class=p>]</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>title</span>
</pre></div> </td></tr></table> <h2 id=personalizar-el-admin>Personalizar el Admin<a class=headerlink href=#personalizar-el-admin title="Permanent link">&para;</a></h2> <p>El Admin permite ser customizado, para poder tener una mejor UX. Todos los cambios para que surtan efecto tendrán que estar hechos en el <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code>, ya sea del proyecto o de cada apps.</p> <h3 id=anadir-mas-columnas>Añadir más columnas<a class=headerlink href=#anadir-mas-columnas title="Permanent link">&para;</a></h3> <p>Igual que teníamos el campo <code class=codehilite><span class=n>readonly_fields</span></code> para mostrar campos ocultos, existe otro comando <code class=codehilite><span class=n>list_display</span></code>, al cual se le pasa una tupla con todos las columnas/campos que queremos tener.</p> <h3 id=ordenar-columnas>Ordenar columnas<a class=headerlink href=#ordenar-columnas title="Permanent link">&para;</a></h3> <p>Para poder ordenador columnas se usa <code class=codehilite><span class=n>ordering</span></code>, donde se le pasa una tupla donde se ordena en función de izquierda a derecha (por ejemplo, primero por autor, luego por fecha de publicación, etc).</p> <h3 id=formulario-de-busqueda>Formulario de búsqueda<a class=headerlink href=#formulario-de-busqueda title="Permanent link">&para;</a></h3> <p>Con <code class=codehilite><span class=n>search_fields</span></code> y una tupla con los campos. Hay que tener cuidado porque por ejemplo, si un campo en realidad se busca por subcampos que tiene dentro, hay que especificarlo y sino dará error. Por ejemplo, si quiero buscar por autor, en realidad quiero buscar por su usuario. O si quiero buscar por categorías, lo que quiero encontrar es el nombre de la categoŕia. La nomemclatura es <code class=codehilite><span class=o>&lt;</span><span class=n>campos</span><span class=o>&gt;</span><span class=n>__</span><span class=o>&lt;</span><span class=n>subcampo</span><span class=o>&gt;</span></code> (2 barras bajas). Por ejemplo:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>ordering</span> <span class=o>=</span><span class=p>(</span><span class=s1>&#39;author__username&#39;</span><span class=p>,</span> <span class=s1>&#39;categories__name&#39;</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=campos-con-fechas>Campos con fechas<a class=headerlink href=#campos-con-fechas title="Permanent link">&para;</a></h3> <p>Para los campos <code class=codehilite><span class=n>datetime</span></code> y similares, hay que definir una jerarquía de fechas con <code class=codehilite><span class=n>date_hierarchy</span></code> y la tupla con los campos.</p> <h3 id=filtros-de-busqueda>Filtros de búsqueda<a class=headerlink href=#filtros-de-busqueda title="Permanent link">&para;</a></h3> <p>Para filtrar por campos se usa <code class=codehilite><span class=n>list_filter</span></code> seguida de la tupla de campos.</p> <h4 id=crear-campos-propios-para-los-filtros>Crear campos propios para los filtros<a class=headerlink href=#crear-campos-propios-para-los-filtros title="Permanent link">&para;</a></h4> <p>Hay campos que pueden dar problemas, por ejemplo los many-to-many. Para eso, se crea una función auxiliar que devuelva lo que realmente quiero. Luego reescribo el método <code class=codehilite><span class=n>short_description</span></code> pasándole el nombre del nuevo campo.</p> <p>En la siguiente sección hay un ejemplo final donde se ve esto en el <code class=codehilite><span class=n>post_categories</span><span class=p>()</span></code>.</p> <h3 id=ejemplo-con-todo>Ejemplo con todo<a class=headerlink href=#ejemplo-con-todo title="Permanent link">&para;</a></h3> <p>Ejemplo en el <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code> de un blog:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.contrib</span> <span class=kn>import</span> <span class=n>admin</span>
<span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Category</span><span class=p>,</span> <span class=n>Post</span>


<span class=c1># Register your models here.</span>
<span class=k>class</span> <span class=nc>CategoryAdmin</span><span class=p>(</span><span class=n>admin</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
    <span class=n>readonly_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>PostAdmin</span><span class=p>(</span><span class=n>admin</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
    <span class=n>readonly_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>)</span>
    <span class=n>list_display</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;author&#39;</span><span class=p>,</span> <span class=s1>&#39;published&#39;</span><span class=p>,</span> <span class=s1>&#39;post_categories&#39;</span><span class=p>)</span>
    <span class=n>ordering</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;author&#39;</span><span class=p>,</span> <span class=s1>&#39;published&#39;</span><span class=p>)</span>
    <span class=n>search_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=s1>&#39;author__username&#39;</span><span class=p>,</span>
                     <span class=s1>&#39;categories__name&#39;</span><span class=p>)</span>
    <span class=n>date_hierarchy</span> <span class=o>=</span> <span class=s1>&#39;published&#39;</span>
    <span class=n>list_filter</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;author__username&#39;</span><span class=p>,</span> <span class=s1>&#39;categories__name&#39;</span><span class=p>,)</span>

    <span class=k>def</span> <span class=nf>post_categories</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
        <span class=k>return</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>categories</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)])</span>
    <span class=n>post_categories</span><span class=o>.</span><span class=n>short_description</span> <span class=o>=</span> <span class=s1>&#39;Categorias&#39;</span>


<span class=n>admin</span><span class=o>.</span><span class=n>site</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>Category</span><span class=p>,</span> <span class=n>CategoryAdmin</span><span class=p>)</span>
<span class=n>admin</span><span class=o>.</span><span class=n>site</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>Post</span><span class=p>,</span> <span class=n>PostAdmin</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=filtros-opciones-en-los-template-tags>Filtros / opciones en los template tags<a class=headerlink href=#filtros-opciones-en-los-template-tags title="Permanent link">&para;</a></h2> <p>En los template tags se le pueden añadir funcionalidades a las variables que se ponen, la forma es</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=cp>{{</span><span class=o>&lt;</span><span class=nv>mivariable</span><span class=o>&gt;</span><span class=err>|</span><span class=o>&lt;</span><span class=nv>filtro</span><span class=o>&gt;</span><span class=cp>}}</span><span class=x></span>
</pre></div> </td></tr></table> <h3 id=formatear-fechas>Formatear fechas<a class=headerlink href=#formatear-fechas title="Permanent link">&para;</a></h3> <p>Por ejemplo para poner un campo fecha en format <code class=codehilite><span class=n>DD</span><span class=o>/</span><span class=n>MM</span><span class=o>/</span><span class=n>YYYY</span></code> podríamos hacer</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{post.published|date:&quot;SHORT_DATE_FORMAT&quot;}}
</pre></div> </td></tr></table> <h3 id=anadir-saltos-de-linea>Añadir saltos de línea<a class=headerlink href=#anadir-saltos-de-linea title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{post.content|linebreaks}}
</pre></div> </td></tr></table> <h3 id=bucles-for-primera-y-ultima-iteracion>Bucles for - primera y última iteración<a class=headerlink href=#bucles-for-primera-y-ultima-iteracion title="Permanent link">&para;</a></h3> <p>Supongamos que queremos sacar todas las catergorías de un post. Esto es una relación many-to-many. Si uso</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{post.categories}}
</pre></div> </td></tr></table> <p>Devuelve <code class=codehilite><span class=k>None</span></code>, porque la query no se ejecuta. Para que esto no pase haríamos</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{post.categories.all}}
</pre></div> </td></tr></table> <p>Pero esto devuele algo que no es legible, lo lógico sería usar un bucle for así</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>{% for category in post.categories.all %}
  {{category.name}}
{% endfor %}
</pre></div> </td></tr></table> <p>Lo que pasa que esto no los pone separados por coma. Y si pongo la coma en el bucle, también la va a poner en el último elemento. Para que eso no pase existe un campo <code class=codehilite><span class=n>forloop</span></code>, que cuenta entre otras cosas con dos variables <code class=codehilite><span class=n>forloop</span><span class=p>.</span><span class=k>first</span></code> y <code class=codehilite><span class=n>forloop</span><span class=p>.</span><span class=k>last</span></code>. Así que ahora podríamos hacer</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>{% for category in post.categories.all %}
  {{category.name}}{% if not forloop.last %}, {% end if%}
{% endfor %}
</pre></div> </td></tr></table> <h2 id=pasar-parametros-a-las-vistas>Pasar parámetros a las vistas<a class=headerlink href=#pasar-parametros-a-las-vistas title="Permanent link">&para;</a></h2> <p>Todos los parámetros que se pasan en la url, se toman como <code class=codehilite><span class=n>string</span></code>, pero se pueden formatear. Si se manda un parámetro que no existe, debemos lanzar un <code class=codehilite><span class=mi>404</span></code>.</p> <p>Ejemplo:</p> <ul> <li>En el <code class=codehilite><span class=n>urls</span><span class=p>.</span><span class=n>py</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
<span class=kn>from</span> <span class=nn>.</span> <span class=kn>import</span> <span class=n>views</span>


<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>blog</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;blog&#39;</span><span class=p>),</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;category/&lt;int:category_id&gt;&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>category</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;category&#39;</span><span class=p>),</span>
<span class=p>]</span>
</pre></div> </td></tr></table> <ul> <li>En el <code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span><span class=p>,</span> <span class=n>get_object_or_404</span>
<span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Post</span><span class=p>,</span> <span class=n>Category</span>


<span class=c1># Create your views here.</span>
<span class=k>def</span> <span class=nf>blog</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;blog/blog.html&#39;</span>
    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;posts&#39;</span><span class=p>:</span> <span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()}</span>
    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>category</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>category_id</span><span class=p>):</span>
    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;blog/category.html&#39;</span>
    <span class=n>category</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>Category</span><span class=p>,</span> <span class=nb>id</span><span class=o>=</span><span class=n>category_id</span><span class=p>)</span>
    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;category&#39;</span><span class=p>:</span> <span class=n>category</span><span class=p>}</span>
    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=buscar-inversamente-en-relaciones>Buscar inversamente en relaciones<a class=headerlink href=#buscar-inversamente-en-relaciones title="Permanent link">&para;</a></h2> <p>Cuando se tiene una relación entre campos, se puede buscar tanto en un sentido como en otro. Veámoslo con un ejemplo:</p> <ul> <li>Tenemos <code class=codehilite><span class=n>Post</span></code> relacionado many-to-many con <code class=codehilite><span class=n>Category</span></code>.</li> <li>Si quiera buscar todos los post que hay en una categoria podría<ol> <li>Buscar por cada post y filtrar por categoría.</li> <li>Buscar por categoría y sacar todos los posts</li> </ol> </li> <li>La segunda opción de búsqueda es más eficiente y para hacerla tendría que hacer</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{category.post_set.all}}
</pre></div> </td></tr></table> <ul> <li>Pero esta forma queda bastante poco intuitiva.</li> <li>Para customizar esto usamos el campo <code class=codehilite><span class=n>related_name</span></code> en el modelo del <code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>categories</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=n>Category</span><span class=p>,</span> <span class=n>related_name</span><span class=o>=</span><span class=s2>&quot;get_posts&quot;</span><span class=p>)</span>
</pre></div> </td></tr></table> <ul> <li>Y ahora en el template</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{category.get_posts.all}}
</pre></div> </td></tr></table> <h2 id=procesador-de-contexto>Procesador de contexto<a class=headerlink href=#procesador-de-contexto title="Permanent link">&para;</a></h2> <p>El contexto en programación se refiere al estado de variables, objetos, etc, y su estado, que hay en un momento concreto. Cuando procesamos una vista, hasta ahora lo que devolvemos es la función <code class=codehilite><span class=n>render</span></code> a la que se le pasa:</p> <ol> <li>La request -&gt; Que no deja de ser un objeto / variable que contiene información sobre la petición http.</li> <li>El template -&gt; El html (y css+js+media) que tiene que cargar.</li> <li>El contexto -&gt; Es un diccionario con variables que le pasamos para que puedan ser usadas en el template.</li> </ol> <p>Hay veces en las que se necesita información de una app en distintas apps. Una buena manera es extender el contexto, añadiendo esa info de una app para poder ser consumida en las demás. Para hacer eso, usamos lo que se llama el <strong>Procesador de contexto</strong>. Para crear uno hacemos:</p> <ol> <li>En la app de la que queremos compartir su información, creamos un archivo llamado <code class=codehilite><span class=n>processors</span><span class=p>.</span><span class=n>py</span></code>.<ol> <li>Creamos dentro una función, a la que se le pasa la <code class=codehilite><span class=n>request</span></code> como parámetro.</li> <li>Dentro creamos un diccionario con información.</li> <li>Devolvemos ese diccionario.</li> </ol> </li> <li>En el <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code> debemos de darlo de alta.<ol> <li>Vamos a la sección <code class=codehilite><span class=n>TEMPLATES</span></code>.</li> <li>Dentro de está <code class=codehilite><span class=k>OPTIONS</span></code>, y dentro de esta se encuentra <code class=codehilite><span class=n>context_processors</span></code>.</li> <li>Añadimos lo siguiente <code class=codehilite><span class=s1>&#39;&lt;app&gt;.processors.&lt;funcion&gt;&#39;</span></code>.</li> </ol> </li> </ol> <p>Esto se ve más fácil con un ejemplo, donde vamos a añadir las RRSS a una web. Todas las RRSS están en una app <code class=codehilite><span class=n>social</span></code></p> <ol> <li>Crear app <code class=codehilite><span class=n>social</span></code> y darla de alta en el <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code></li> <li> <p>Modificar su <code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>


<span class=c1># Create your models here.</span>
<span class=k>class</span> <span class=nc>Link</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>key</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>SlugField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Nombre clave&#39;</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
                           <span class=n>unique</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Red social&#39;</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>URLField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Enlace&#39;</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                          <span class=n>blank</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
    <span class=n>created</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Creado&#39;</span><span class=p>)</span>
    <span class=n>updated</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Actualizado&#39;</span><span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>verbose_name</span> <span class=o>=</span> <span class=s1>&#39;enlace&#39;</span>
        <span class=n>verbose_name_plural</span> <span class=o>=</span> <span class=s1>&#39;enlaces&#39;</span>
        <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
</pre></div> </td></tr></table> </li> <li> <p>Modificar el <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code>, hacer las migraciones y migrarlas</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.contrib</span> <span class=kn>import</span> <span class=n>admin</span>
<span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Link</span>


<span class=c1># Register your models here.</span>
<span class=k>class</span> <span class=nc>LinkAdmin</span><span class=p>(</span><span class=n>admin</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
    <span class=n>readonly_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>)</span>


<span class=n>admin</span><span class=o>.</span><span class=n>site</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>Link</span><span class=p>,</span> <span class=n>LinkAdmin</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> <li> <p>Como no hay vista, ni template pasamos directamente a la fase de procesador de contexto.</p> </li> <li> <p>Crear el <code class=codehilite><span class=n>processor</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Link</span>


<span class=k>def</span> <span class=nf>ctx_dict</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=n>ctx</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>link</span> <span class=ow>in</span> <span class=n>Link</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>():</span>
        <span class=n>ctx</span><span class=p>[</span><span class=n>link</span><span class=o>.</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>link</span><span class=o>.</span><span class=n>url</span>
    <span class=k>return</span> <span class=n>ctx</span>
</pre></div> </td></tr></table> </li> <li> <p>Darlo de alta en el <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code></p> </li> <li>Arrancar el server, entrar al Admin y crear un par de objetos con por ejemplo las claves LINK_FACEBOOK, LINK_TWITTER y LINK_INSTAGRAM.</li> <li> <p>Modificar el <code class=codehilite><span class=n>base</span><span class=p>.</span><span class=n>html</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c>&lt;!-- Pié de página --&gt;</span>
  <span class=p>&lt;</span><span class=nt>footer</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;footer text-faded text-center py-5&quot;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;container&quot;</span><span class=p>&gt;</span>
      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;m-0&quot;</span><span class=p>&gt;</span>
        {% if LINK_TWITTER %}
          <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{{LINK_TWITTER}}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>
            <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa-stack fa-lg&quot;</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-circle fa-stack-2x&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-twitter fa-stack-1x fa-inverse&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
            <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
          <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
        {% endif %}
        {% if LINK_FACEBOOK %}
          <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{{LINK_FACEBOOK}}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>
            <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa-stack fa-lg&quot;</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-circle fa-stack-2x&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-facebook fa-stack-1x fa-inverse&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
            <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
          <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
        {% endif %}
        {% if LINK_INSTAGRAM %}
          <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{{LINK_INSTAGRAM}}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>
            <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa-stack fa-lg&quot;</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-circle fa-stack-2x&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
              <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;fa fa-instagram fa-stack-1x fa-inverse&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
            <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
          <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
        {% endif %}
    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;m-0 mbt&quot;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;sample&#39; %}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>Política de privacidad<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> ·
        <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;sample&#39; %}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>Aviso legal<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> ·
        <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;sample&#39; %}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>Cookies<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
  <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;m-0 mbt1&quot;</span><span class=p>&gt;</span><span class=ni>&amp;copy;</span> La Caffettiera 2018<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>footer</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> </li> </ol> <h2 id=template-tags-propios>Template Tags propios<a class=headerlink href=#template-tags-propios title="Permanent link">&para;</a></h2> <p>Es una alternativa al Procesador de Contexto más flexible, pero también consume más recursos:</p> <ol> <li>En la app que su información sea compartida hay que crear:<ol> <li>Carpeta <code class=codehilite><span class=n>templatetags</span></code></li> <li>Dentro un <code class=codehilite><span class=n>__init__</span><span class=p>.</span><span class=n>py</span></code></li> <li>Un fichero python, <code class=codehilite><span class=n>ficherotags</span><span class=p>.</span><span class=n>py</span></code>, para los template tags .</li> </ol> </li> <li> <p>El <code class=codehilite><span class=n>ficherotags</span><span class=p>.</span><span class=n>py</span></code> debe contener los template de django y el modelo de páginas</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django</span> <span class=kn>import</span> <span class=n>template</span>
<span class=kn>from</span> <span class=nn>page.models</span> <span class=kn>import</span> <span class=n>Page</span>
</pre></div> </td></tr></table> </li> <li> <p>Luego hay que crear un registro de la librería de templates</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>register</span> <span class=o>=</span> <span class=n>template</span><span class=o>.</span><span class=n>Library</span><span class=p>()</span>
</pre></div> </td></tr></table> </li> <li> <p>Ahora creamos una función, <code class=codehilite><span class=o>&lt;</span><span class=n>nuevotag</span><span class=o>&gt;</span></code>, con el decorador <code class=codehilite><span class=nv>@register</span><span class=p>.</span><span class=n>simple_tag</span><span class=w></span></code>.</p> </li> <li>En esa función vamos a poder jugar con las páginas, con por ejemplo <code class=codehilite><span class=n>Page</span><span class=p>.</span><span class=n>objects</span><span class=p>.</span><span class=k>all</span><span class=p>()</span></code></li> <li>Para poder usar <code class=codehilite><span class=o>&lt;</span><span class=n>nuevotag</span><span class=o>&gt;</span></code> en un template hay que cargar el fichero <code class=codehilite><span class=n>ficherotags</span><span class=p>.</span><span class=n>py</span></code>.</li> </ol> <p>Ejemplo:</p> <ol> <li>Tenemos los típicos links en el footer sobre las cookies y demás.</li> <li>Creamos una app <code class=codehilite><span class=n>pages</span></code></li> <li> <p><code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>


<span class=c1># Create your models here.</span>
<span class=k>class</span> <span class=nc>Page</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Título&#39;</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>)</span>
    <span class=n>created</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Creado&#39;</span><span class=p>)</span>
    <span class=n>updated</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Actualizado&#39;</span><span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>verbose_name</span> <span class=o>=</span> <span class=s1>&#39;página&#39;</span>
        <span class=n>verbose_name_plural</span> <span class=o>=</span> <span class=s1>&#39;páginas&#39;</span>
        <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>title</span>
</pre></div> </td></tr></table> </li> <li> <p><code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span><span class=p>,</span> <span class=n>get_object_or_404</span>
<span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Page</span>


<span class=c1># Create your views here.</span>
<span class=k>def</span> <span class=nf>page</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>page_id</span><span class=p>):</span>
    <span class=n>page</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>Page</span><span class=p>,</span> <span class=nb>id</span><span class=o>=</span><span class=n>page_id</span><span class=p>)</span>
    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;pages/sample.html&#39;</span>
    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;page&#39;</span><span class=p>:</span> <span class=n>page</span><span class=p>}</span>
    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> <li> <p><code class=codehilite><span class=n>urls</span><span class=p>.</span><span class=n>py</span></code></p> <p>Proyecto</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span><span class=p>,</span> <span class=n>include</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=c1># Path del pages</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;page/&#39;</span><span class=p>,</span> <span class=n>include</span><span class=p>(</span><span class=s1>&#39;pages.urls&#39;</span><span class=p>)),</span>
    <span class=o>...</span>
<span class=p>]</span>
</pre></div> </td></tr></table> <p>App pages</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
<span class=kn>from</span> <span class=nn>.</span> <span class=kn>import</span> <span class=n>views</span>


<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;&lt;int:page_id&gt;/&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>page</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;page&#39;</span><span class=p>),</span>
    <span class=o>...</span>
<span class=p>]</span>
</pre></div> </td></tr></table> </li> <li> <p><code class=codehilite><span class=n>pages</span><span class=o>/</span><span class=n>templatetags</span><span class=o>/</span><span class=n>pages_extra</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django</span> <span class=kn>import</span> <span class=n>template</span>
<span class=kn>from</span> <span class=nn>pages.models</span> <span class=kn>import</span> <span class=n>Page</span>

<span class=n>register</span> <span class=o>=</span> <span class=n>template</span><span class=o>.</span><span class=n>Library</span><span class=p>()</span>


<span class=nd>@register.simple_tag</span>
<span class=k>def</span> <span class=nf>get_page_list</span><span class=p>():</span>
    <span class=n>pages</span> <span class=o>=</span> <span class=n>Page</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>pages</span>
</pre></div> </td></tr></table> </li> <li> <p><code class=codehilite><span class=n>core</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>core</span><span class=o>/</span><span class=n>base</span><span class=p>.</span><span class=n>html</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span>{% load pages_extras %}
{% get_page_list as page_list %}
{% for page in page_list %}
  <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;page&#39; page.id %}&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;link&quot;</span><span class=p>&gt;</span>{{page.title}}<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> {% if not forloop.last %}.{% endif %}
{% endfor %}
</pre></div> </td></tr></table> </li> </ol> <h2 id=ordenacion-directa-de-paginas>Ordenación directa de páginas<a class=headerlink href=#ordenacion-directa-de-paginas title="Permanent link">&para;</a></h2> <p>Si quisiera dar cierto orden a un tipo de elementos de una app, debemos de:</p> <ol> <li> <p>En el <code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code> añadir un campo por ejemplo</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Page</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
  <span class=o>...</span>
  <span class=n>order</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>SmallIntegerField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Orden&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

  <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
    <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;order&#39;</span><span class=p>]</span>
</pre></div> </td></tr></table> </li> <li> <p>En el <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>PageAdmin</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
  <span class=o>...</span>
  <span class=n>list_display</span><span class=p>(</span><span class=s1>&#39;order&#39;</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> <li> <p>Ahora en el Admin puedo administrar pesos para obtener esa ordenación.</p> </li> </ol> <h2 id=edicion-directa-de-paginas>Edición directa de páginas<a class=headerlink href=#edicion-directa-de-paginas title="Permanent link">&para;</a></h2> <p>En el propio procesador de contexto contamos con el usuario de la sesión en <code class=codehilite><span class=n>django</span><span class=p>.</span><span class=n>contrib</span><span class=p>.</span><span class=n>auth</span><span class=p>.</span><span class=n>context_processors</span><span class=p>.</span><span class=n>auth</span></code>. Así que si queremos que ciertas partes aparezcan si un usuario está autenticado, podemos hacer en el template base</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>{% if user.is_authenticated %}
  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;admin:&lt;app&gt;_&lt;modelo&gt;_&lt;accion&gt;&#39; &lt;objeto-id&gt;%}&quot;</span><span class=p>&gt;</span>Editar<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
{% endif %}
</pre></div> </td></tr></table> <p>Con el ejemplo anterior sería <code class=codehilite><span class=n>base</span><span class=p>.</span><span class=n>html</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>{% if user.is_authenticated %}
  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;{% url &#39;admin:pages_page_change&#39; page.id %}&quot;</span><span class=p>&gt;</span>Editar<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
{% endif %}
</pre></div> </td></tr></table> <h2 id=editor-wysiwyg-en-el-admin>Editor WYSIWYG en el Admin<a class=headerlink href=#editor-wysiwyg-en-el-admin title="Permanent link">&para;</a></h2> <p>Para añadir un editor wysiswyg en el Admin podemos usar el <code class=codehilite><span class=n>ckeditor</span></code></p> <ol> <li> <p>Instalar <code class=codehilite><span class=n>ckeditor</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>pip install django-ckeditor
</pre></div> </td></tr></table> </li> <li> <p>Añadirlo en las apps instaladas -&gt; <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=s1>&#39;ckeditor&#39;</span><span class=p>,</span>
<span class=p>]</span>
</pre></div> </td></tr></table> </li> <li> <p>En el <code class=codehilite><span class=n>models</span><span class=p>.</span><span class=n>py</span></code> de la app donde queremos tener el campo con el editor:</p> <ol> <li>Importamos <code class=codehilite><span class=n>ckeditor</span><span class=p>.</span><span class=n>fields</span><span class=p>.</span><span class=n>RichTextField</span></code></li> <li>Modificamos el campo deseado</li> <li>Hacemos las migraciones</li> </ol> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=o>...</span>
<span class=kn>from</span> <span class=nn>ckeditor.fields</span> <span class=kn>import</span> <span class=n>RichTextField</span>


<span class=k>class</span> <span class=nc>Page</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
  <span class=o>...</span>
  <span class=n>content</span> <span class=o>=</span> <span class=n>RichTextField</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> </ol> <p>Si queremos redefinir la barra del editor, en el <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code> al final añadimos</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1># Ckeditor</span>
<span class=n>CKEDITOR_CONFIGS</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;default&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;toolbar&#39;</span><span class=p>:</span> <span class=s1>&#39;Basic&#39;</span><span class=p>,</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>El modo <code class=codehilite><span class=s1>&#39;Basic&#39;</span></code> es el más simple, pero podemos poner <code class=codehilite><span class=k>None</span></code> si queremos tener todas las opciones.</p> <p>Repo Oficial -&gt; <a href=https://github.com/django-ckeditor/django-ckeditor>aquí</a><br> Docu Oficial -&gt; <a href=https://django-ckeditor.readthedocs.io/en/latest/ >aquí</a></p> <p>En su repo nos viene de ejemplo esto</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>CKEDITOR_CONFIGS</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;default&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;toolbar&#39;</span><span class=p>:</span> <span class=s1>&#39;Custom&#39;</span><span class=p>,</span>
        <span class=s1>&#39;toolbar_Custom&#39;</span><span class=p>:</span> <span class=p>[</span>
            <span class=p>[</span><span class=s1>&#39;Bold&#39;</span><span class=p>,</span> <span class=s1>&#39;Italic&#39;</span><span class=p>,</span> <span class=s1>&#39;Underline&#39;</span><span class=p>],</span>
            <span class=p>[</span><span class=s1>&#39;NumberedList&#39;</span><span class=p>,</span> <span class=s1>&#39;BulletedList&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=s1>&#39;Outdent&#39;</span><span class=p>,</span> <span class=s1>&#39;Indent&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=s1>&#39;JustifyLeft&#39;</span><span class=p>,</span> <span class=s1>&#39;JustifyCenter&#39;</span><span class=p>,</span> <span class=s1>&#39;JustifyRight&#39;</span><span class=p>,</span> <span class=s1>&#39;JustifyBlock&#39;</span><span class=p>],</span>
            <span class=p>[</span><span class=s1>&#39;Link&#39;</span><span class=p>,</span> <span class=s1>&#39;Unlink&#39;</span><span class=p>],</span>
            <span class=p>[</span><span class=s1>&#39;RemoveFormat&#39;</span><span class=p>,</span> <span class=s1>&#39;Source&#39;</span><span class=p>]</span>
        <span class=p>]</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>Para que el contenido creado en el editor se vea sin problemas en el template, tenemos que ponerle el filtro <code class=codehilite><span class=n>safe</span></code> al tag donde esté este contenido. En el ejemplo anterior en <code class=codehilite><span class=n>miproyecto</span><span class=o>/</span><span class=n>pages</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>pages</span><span class=o>/</span><span class=n>sample</span><span class=p>.</span><span class=n>html</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>{{page.content|safe}}
</pre></div> </td></tr></table> <h2 id=formularios>Formularios<a class=headerlink href=#formularios title="Permanent link">&para;</a></h2> <p>Para usar formularios en una app:</p> <ol> <li>Crear en la app <code class=codehilite><span class=n>forms</span><span class=p>.</span><span class=n>py</span></code></li> <li> <p>Al igual que con los modelos:</p> <ol> <li>Importamos el "modelo" -&gt; <code class=codehilite><span class=kn>from</span> <span class=nn>django</span> <span class=kn>import</span> <span class=n>forms</span></code></li> <li>Creamos una clase que herede del "modelo" -&gt; <code class=codehilite><span class=k>class</span> <span class=n>MiClaseForm</span>(<span class=n>forms</span>.<span class=n>Form</span>):</code></li> <li>Generamos los campos del formulario, por ejemplo</li> </ol> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>name</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Nombre&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
<span class=n>email</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>EmailField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Email&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
<span class=n>content</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>widget</span><span class=o>=</span><span class=n>forms</span><span class=o>.</span><span class=n>Textarea</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> <li> <p>En el <code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code> importamos el o los formularios, y los añadimos al contexto de la vista.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
<span class=kn>from</span> <span class=nn>.forms</span> <span class=kn>import</span> <span class=n>MiClaseForm</span>


<span class=k>def</span> <span class=nf>mivista</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
  <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;miapp/miapp.html&#39;</span>
  <span class=n>context</span> <span class=o>=</span> <span class=p>{</span>
      <span class=s1>&#39;form&#39;</span><span class=p>:</span> <span class=n>MiClaseForm</span><span class=p>(),</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</pre></div> </td></tr></table> </li> <li> <p>En el template lo dibujamos:</p> <ul> <li>Simplemente con <code class=codehilite><span class=cp>{{</span><span class=nv>form</span><span class=cp>}}</span><span class=x></span></code> ya lo saca, pero totalmente desformateado.</li> <li>Podemos darle un formato más como párrafos <code class=codehilite><span class=cp>{{</span><span class=nv>form.as_p</span><span class=cp>}}</span><span class=x></span></code>.</li> <li>Como si fuera una lista</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
  {{form.as_ul}}
<span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> <ul> <li>Como una tabla</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>&lt;</span><span class=nt>table</span><span class=p>&gt;</span>
  {{form.as_table}}
<span class=p>&lt;/</span><span class=nt>table</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> </li> <li> <p>Para añadirle el botón de enviar:</p> <ol> <li>Metemos el formulario dentro de un <code class=codehilite><span class=o>&lt;</span><span class=n>form</span><span class=o>&gt;</span></code></li> <li>En el parámetro <code class=codehilite><span class=n>action</span></code> será la web donde ir / acción a hacer cuando se envíe el formulario</li> <li>En el <code class=codehilite><span class=k>method</span></code> el método para enviar el formulario:<ul> <li><code class=codehilite><span class=n>POST</span></code> es el más recomendado.</li> <li><code class=codehilite><span class=k>GET</span></code> no se recomienda.</li> </ul> </li> <li>Dentro introducimos:<ol> <li>Al principio <code class=codehilite><span class=err>{</span><span class=o>%</span> <span class=n>csrf_token</span> <span class=o>%</span><span class=err>}</span></code> por motivos de seguridad.</li> <li>Al final un <code class=codehilite><span class=o>&lt;</span><span class=k>input</span><span class=o>&gt;</span></code>:<ul> <li>Con <code class=codehilite><span class=k>type</span><span class=o>=</span><span class=ss>&quot;submit&quot;</span></code></li> <li>Y un texto a mostrar <code class=codehilite><span class=n>value</span><span class=o>=</span><span class=ss>&quot;Enviar&quot;</span></code>.</li> </ul> </li> </ol> </li> </ol> </li> <li> <p>Validar si el formulario es correcto:</p> <ol> <li>En la misma vista del <code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code> miramos si accedemos con POST con <code class=codehilite><span class=n>request</span><span class=p>.</span><span class=k>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span></code></li> <li>Recupero el formulario con <code class=codehilite><span class=n>mi_formulario</span> <span class=o>=</span> <span class=n>MiClaseForm</span><span class=p>(</span><span class=k>data</span><span class=o>=</span><span class=n>request</span><span class=p>.</span><span class=n>POST</span><span class=p>)</span></code></li> <li>Compruebo si es valido con <code class=codehilite><span class=n>mi_forumulario</span><span class=p>.</span><span class=n>is_valid</span><span class=p>()</span></code></li> <li>Formateo los valores por defecto si alguno está vacío</li> <li>Hago una redirección con la función <code class=codehilite><span class=n>django</span><span class=p>.</span><span class=n>shortcuts</span><span class=p>.</span><span class=n>redirect</span></code><ul> <li>Se recomiendo usar la función <code class=codehilite><span class=n>django</span><span class=p>.</span><span class=n>urls</span><span class=p>.</span><span class=n>reverse</span></code> para la redirección</li> </ul> </li> </ol> </li> </ol> <p>Ejemplo de la app <code class=codehilite><span class=n>contact</span></code>:</p> <ul> <li><code class=codehilite><span class=n>forms</span><span class=p>.</span><span class=n>py</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django</span> <span class=kn>import</span> <span class=n>forms</span>


<span class=k>class</span> <span class=nc>ContactForm</span><span class=p>(</span><span class=n>forms</span><span class=o>.</span><span class=n>Form</span><span class=p>):</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Nombre&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
    <span class=n>email</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>EmailField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Email&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                              <span class=n>widget</span><span class=o>=</span><span class=n>forms</span><span class=o>.</span><span class=n>Textarea</span><span class=p>)</span>
</pre></div> </td></tr></table> <ul> <li><code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span><span class=p>,</span> <span class=n>redirect</span>
<span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>reverse</span>
<span class=kn>from</span> <span class=nn>.forms</span> <span class=kn>import</span> <span class=n>ContactForm</span>


<span class=c1># Create your views here.</span>
<span class=k>def</span> <span class=nf>contact</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
        <span class=n>contact_form</span> <span class=o>=</span> <span class=n>ContactForm</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>contact_form</span><span class=o>.</span><span class=n>is_valid</span><span class=p>():</span>
            <span class=n>name</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=n>email</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=n>content</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span><span class=s1>&#39;contact&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;?OK&#39;</span><span class=p>)</span>
    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;contact/contact.html&#39;</span>
    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;form&#39;</span><span class=p>:</span> <span class=n>ContactForm</span><span class=p>(),</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</pre></div> </td></tr></table> <ul> <li><code class=codehilite><span class=n>contact</span><span class=p>.</span><span class=n>html</span></code></li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c>&lt;!-- Formulario de contacto --&gt;</span>
{% if &#39;OK&#39; in request.GET %}
    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>strong</span><span class=p>&gt;</span>Su mensaje se ha reenviado correctamente<span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
{% endif %}
<span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&quot;&quot;</span> <span class=na>method</span><span class=o>=</span><span class=s>&quot;POST&quot;</span><span class=p>&gt;</span>
    {% csrf_token %}
    <span class=p>&lt;</span><span class=nt>table</span><span class=p>&gt;</span>
        {{form.as_table}}
    <span class=p>&lt;/</span><span class=nt>table</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&quot;submit&quot;</span> <span class=na>value</span><span class=o>=</span><span class=s>&quot;Enviar&quot;</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> <h3 id=maquetar-formulario>Maquetar formulario<a class=headerlink href=#maquetar-formulario title="Permanent link">&para;</a></h3> <p>Para poder dar un aspecto visual propio a un formulario es muy sencillo:</p> <ol> <li>Tenemos que volver a tener en nuestro <code class=codehilite><span class=n>form</span></code>:<ol> <li>Sus parámetros <code class=codehilite><span class=n>action</span></code> + <code class=codehilite><span class=k>method</span></code></li> <li>El <code class=codehilite><span class=err>{</span><span class=o>%</span> <span class=n>csrf_token</span> <span class=o>%</span><span class=err>}</span></code> al principio</li> <li>El <code class=codehilite><span class=o>&lt;</span><span class=k>input</span> <span class=k>type</span><span class=o>=</span><span class=s1>&#39;submit&#39;</span> <span class=n>value</span><span class=o>=</span><span class=s1>&#39;Enviar&#39;</span><span class=o>&gt;</span></code> al final </li> </ol> </li> <li>En cada campo:<ol> <li>Poner el campo del formulario</li> <li>Añadirle despues al final el <code class=codehilite><span class=cp>{{</span><span class=nv>form</span><span class=err>.</span><span class=o>&lt;</span><span class=nv>campo</span><span class=o>&gt;</span><span class=nv>.errors</span><span class=cp>}}</span><span class=x></span></code></li> </ol> </li> <li>Modificar los estilos de cada campo en el <code class=codehilite><span class=n>forms</span><span class=p>.</span><span class=n>py</span></code>:<ul> <li>Dentro de cada campo modificamos el parámetro <code class=codehilite><span class=n>widget</span></code>.<ul> <li>A este se le pasa un tipo de campo</li> <li>Dentro de este tipo, generamos los elementos CSS dentro del diccionario <code class=codehilite><span class=n>attrs</span></code>.</li> </ul> </li> <li>Podemos ajustar también el tamaño con <code class=codehilite><span class=n>min_length</span></code> o <code class=codehilite><span class=n>max_length</span></code>.</li> </ul> </li> </ol> <p>Ejemplo</p> <ul> <li><code class=codehilite><span class=n>contact</span><span class=p>.</span><span class=n>html</span></code> app contact</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c>&lt;!-- Formulario de contacto --&gt;</span>
{% if &#39;OK&#39; in request.GET %}
    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>strong</span><span class=p>&gt;</span>Su mensaje se ha reenviado correctamente<span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
{% endif %}
<span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&quot;&quot;</span> <span class=na>method</span><span class=o>=</span><span class=s>&quot;POST&quot;</span><span class=p>&gt;</span>
    {% csrf_token %}
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;form-group&quot;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>Nombre *<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;input-group&quot;</span><span class=p>&gt;</span>
            {{form.name}}
        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
        {{form.name.errors}}
    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;form-group&quot;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>Email *<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;input-group&quot;</span><span class=p>&gt;</span>
            {{form.email}}
        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
        {{form.email.errors}}
    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;form-group&quot;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>Mensaje *<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;input-group&quot;</span><span class=p>&gt;</span>
            {{form.content}}
        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
        {{form.content.errors}}
    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;text-center&quot;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&quot;submit&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;btn btn-primary btn-block py-2&quot;</span> <span class=na>value</span><span class=o>=</span><span class=s>&quot;Enviar&quot;</span><span class=p>&gt;</span>
    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> <ul> <li><code class=codehilite><span class=n>forms</span><span class=p>.</span><span class=n>py</span></code> app contact</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django</span> <span class=kn>import</span> <span class=n>forms</span>


<span class=k>class</span> <span class=nc>ContactForm</span><span class=p>(</span><span class=n>forms</span><span class=o>.</span><span class=n>Form</span><span class=p>):</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Nombre&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                           <span class=n>widget</span><span class=o>=</span><span class=n>forms</span><span class=o>.</span><span class=n>TextInput</span><span class=p>(</span>
                               <span class=n>attrs</span><span class=o>=</span><span class=p>{</span>
                                   <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;form-control&#39;</span><span class=p>,</span>
                                   <span class=s1>&#39;placeholder&#39;</span><span class=p>:</span> <span class=s1>&#39;Escribe tu nombre&#39;</span>
                               <span class=p>}</span>
                           <span class=p>),</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
    <span class=n>email</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>EmailField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Email&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                             <span class=n>widget</span><span class=o>=</span><span class=n>forms</span><span class=o>.</span><span class=n>EmailInput</span><span class=p>(</span>
                                 <span class=n>attrs</span><span class=o>=</span><span class=p>{</span>
                                     <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;form-control&#39;</span><span class=p>,</span>
                                     <span class=s1>&#39;placeholder&#39;</span><span class=p>:</span> <span class=s1>&#39;Escribe tu email&#39;</span>
                                 <span class=p>}</span>
                           <span class=p>),</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Contenido&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span>
                              <span class=n>widget</span><span class=o>=</span><span class=n>forms</span><span class=o>.</span><span class=n>Textarea</span><span class=p>(</span>
                                  <span class=n>attrs</span><span class=o>=</span><span class=p>{</span>
                                      <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;form-control&#39;</span><span class=p>,</span>
                                      <span class=s1>&#39;rows&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
                                      <span class=s1>&#39;placeholder&#39;</span><span class=p>:</span> <span class=s1>&#39;Escribe tu mensaje&#39;</span>
                                  <span class=p>}</span>
                              <span class=p>),</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=enviar-emails>Enviar emails<a class=headerlink href=#enviar-emails title="Permanent link">&para;</a></h2> <p>Para poder enviar emails hay configurar el correo, y existen muchas opciones.</p> <p>En este ejemplo para pruebas uso <a href=https://mailtrap.io/ >mailtrap.io</a>. Dentro de la <code class=codehilite><span class=n>demo_inbox</span></code> podemos buscar la configuración para Django. La copiamos y la pegamos al final del <code class=codehilite><span class=n>settings</span><span class=p>.</span><span class=n>py</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1># Email config</span>
<span class=n>EMAIL_HOST</span> <span class=o>=</span> <span class=s1>&#39;smtp.mailtrap.io&#39;</span>
<span class=n>EMAIL_HOST_USER</span> <span class=o>=</span> <span class=s1>&#39;9e9652ad27c050&#39;</span>
<span class=n>EMAIL_HOST_PASSWORD</span> <span class=o>=</span> <span class=s1>&#39;a4e2f4e19b02dc&#39;</span>
<span class=n>EMAIL_PORT</span> <span class=o>=</span> <span class=s1>&#39;2525&#39;</span>
</pre></div> </td></tr></table> <p>Para enviar el correo, el <code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code> de la app correspondiente:</p> <ol> <li>Importamos la <code class=codehilite><span class=n>django</span><span class=p>.</span><span class=n>core</span><span class=p>.</span><span class=n>mail</span><span class=p>.</span><span class=n>EmailMessage</span></code></li> <li>Dentro de esta tenemos que poner:<ol> <li>Asunto</li> <li>Cuerpo</li> <li>Email de origen</li> <li>Email de destino</li> <li><code class=codehilite><span class=n>reply_to</span><span class=o>=</span><span class=p>[</span><span class=o>&lt;</span><span class=n>objeto</span><span class=o>-</span><span class=n>EmailMessage</span><span class=o>&gt;</span><span class=p>]</span></code></li> </ol> </li> </ol> <p>Ejemplo con <code class=codehilite><span class=n>views</span><span class=p>.</span><span class=n>py</span></code> de la app Contact anterior</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span><span class=p>,</span> <span class=n>redirect</span>
<span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>reverse</span>
<span class=kn>from</span> <span class=nn>django.core.mail</span> <span class=kn>import</span> <span class=n>EmailMessage</span>

<span class=kn>from</span> <span class=nn>.forms</span> <span class=kn>import</span> <span class=n>ContactForm</span>


<span class=c1># Create your views here.</span>
<span class=k>def</span> <span class=nf>contact</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
        <span class=n>contact_form</span> <span class=o>=</span> <span class=n>ContactForm</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>contact_form</span><span class=o>.</span><span class=n>is_valid</span><span class=p>():</span>
            <span class=n>name</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=n>email</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=n>content</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=n>mail</span> <span class=o>=</span> <span class=n>EmailMessage</span><span class=p>(</span>
                <span class=s1>&#39;MiAppDjango: Hola&#39;</span><span class=p>,</span>
                <span class=n>f</span><span class=s1>&#39;De {name} &lt;{email}&gt;</span><span class=se>\n\n</span><span class=s1>Escribio:</span><span class=se>\n\n</span><span class=s1>{content}&#39;</span><span class=p>,</span>
                <span class=s1>&#39;noreply@inbox.mailtrap.io&#39;</span><span class=p>,</span>
                <span class=p>[</span><span class=s1>&#39;tuemail@email.com&#39;</span><span class=p>],</span>
                <span class=n>reply_to</span><span class=o>=</span><span class=p>[</span><span class=n>email</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>mail</span><span class=o>.</span><span class=n>send</span><span class=p>()</span>
            <span class=k>except</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span><span class=s1>&#39;contact&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;?FAIL&#39;</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
              <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span><span class=s1>&#39;contact&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;?OK&#39;</span><span class=p>)</span>

    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;contact/contact.html&#39;</span>
    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;form&#39;</span><span class=p>:</span> <span class=n>ContactForm</span><span class=p>(),</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>template</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=grupos-usuarios-y-permisos>Grupos, Usuarios y permisos<a class=headerlink href=#grupos-usuarios-y-permisos title="Permanent link">&para;</a></h2> <p>Todo se hace desde el Admin y es muy intuitivo.</p> <p>Lo lógico es crear primero un grupo con unos permisos concretos (app que puede ver, editar, borrar).</p> <p>Luego se crea un usuario con su nombre y contraseña. Si queremos que pueda acceder al admin debemos añadirlo como <code class=codehilite><span class=n>staff</span></code>.</p> <p>Por último para ver si todo funciona, accedemos al admin con el nuevo usuario.</p> <p>Si hay campos que queremos que aparezcan como solo lectura para cierto grupo, podemos editar el <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code> de la app con:</p> <ol> <li>Creamos el método <code class=codehilite><span class=n>def</span> <span class=n>get_readonly_fields</span><span class=p>(</span><span class=k>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>obj</span><span class=o>=</span><span class=k>None</span><span class=p>)</span></code></li> <li>Dentro filtramos si el usuario pertenece a un grupo o no<ul> <li>Si pertenece a un grupo devolvemos unos readonly</li> <li>Si no pertenece devolvemos otros</li> </ul> </li> </ol> <p>Ejemplo:</p> <ul> <li>Para una app <code class=codehilite><span class=n>social</span></code> hemos creado un grupo llamado <code class=codehilite><span class=n>Personal</span></code>.</li> <li>No queremos que pueda editar los campos <code class=codehilite><span class=k>key</span></code> y <code class=codehilite><span class=n>name</span></code> que usaremos para las RRSS.</li> <li>Su <code class=codehilite><span class=k>admin</span><span class=p>.</span><span class=n>py</span></code> queda como</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>from</span> <span class=nn>django.contrib</span> <span class=kn>import</span> <span class=n>admin</span>
<span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Link</span>


<span class=c1># Register your models here.</span>
<span class=k>class</span> <span class=nc>LinkAdmin</span><span class=p>(</span><span class=n>admin</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
    <span class=n>readonly_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>get_readonly_fields</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>obj</span><span class=o>=</span><span class=bp>None</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>user</span><span class=o>.</span><span class=n>groups</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;Personal&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
            <span class=k>return</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>,</span> <span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;updated&#39;</span><span class=p>)</span>


<span class=n>admin</span><span class=o>.</span><span class=n>site</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>Link</span><span class=p>,</span> <span class=n>LinkAdmin</span><span class=p>)</span>
</pre></div> </td></tr></table> <ul> <li>Hacemos las migraciones.</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../django-principiante/ title=Principiante class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Anterior </span> Principiante </span> </div> </a> <a href=../django-avanzado/ title=Avanzado class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Siguiente </span> Avanzado </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Cristóbal Contreras </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://github.com/crisconru class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/crisconru class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/cristobalcontrerasrubio class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.245445c6.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.es.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>