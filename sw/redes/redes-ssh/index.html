<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Apuntes de fácil acceso para distintas tecnologías."><link href=https://crisconru.github.io/sw/redes/redes-ssh/ rel=canonical><meta name=author content="Cristóbal Contreras Rubio"><meta name=lang:clipboard.copy content="Copiar al portapapeles"><meta name=lang:clipboard.copied content="Copiado al portapapeles"><meta name=lang:search.language content=es><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No se encontraron documentos"><meta name=lang:search.result.one content="1 documento encontrado"><meta name=lang:search.result.other content="# documentos encontrados"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>SSH - Tips de Cristo</title><link rel=stylesheet href=../../../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#4caf50><script src=../../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=green data-md-color-accent=pink> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#ssh tabindex=1 class=md-skip> Saltar a contenido </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://crisconru.github.io/ title="Tips de Cristo" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Tips de Cristo </span> <span class=md-header-nav__topic> SSH </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Búsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Teclee para comenzar búsqueda </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/crisconru/tips title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> crisconru/tips </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://crisconru.github.io/ title="Tips de Cristo" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Tips de Cristo </label> <div class=md-nav__source> <a href=https://github.com/crisconru/tips title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> crisconru/tips </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Contenido class=md-nav__link> Contenido </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> Devops </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-1 type=checkbox id=nav-2-1-1> <label class=md-nav__link for=nav-2-1-1> Ansible </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-1> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/devops/ansible/ansible/ title=Ansible class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../../../code/devops/ansible/inventario/ title=Inventario class=md-nav__link> Inventario </a> </li> <li class=md-nav__item> <a href=../../../code/devops/ansible/comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> <li class=md-nav__item> <a href=../../../code/devops/ansible/configuracion/ title=Configuracion class=md-nav__link> Configuracion </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-1-5 type=checkbox id=nav-2-1-1-5> <label class=md-nav__link for=nav-2-1-1-5> Playbooks </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-1-1-5> Playbooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/devops/ansible/playbook/playbook/ title=Playbook class=md-nav__link> Playbook </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-2 type=checkbox id=nav-2-1-2> <label class=md-nav__link for=nav-2-1-2> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-2> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-aclaraciones/ title=Aclaraciones class=md-nav__link> Aclaraciones </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-instalacion/ title=Instalación class=md-nav__link> Instalación </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-hub/ title="Docker Hub" class=md-nav__link> Docker Hub </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-comandos/ title="Comandos docker" class=md-nav__link> Comandos docker </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-contenedores/ title="Lanzar contenedores" class=md-nav__link> Lanzar contenedores </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-imagenes/ title="Crear imágenes" class=md-nav__link> Crear imágenes </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-dockerfile/ title=Dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-volumes/ title=Volumes class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-network/ title=Network class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../../../code/devops/docker/docker-dockercompose/ title="Docker Compose" class=md-nav__link> Docker Compose </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-3 type=checkbox id=nav-2-1-3> <label class=md-nav__link for=nav-2-1-3> ELK </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-3> ELK </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/devops/elk/elk/ title=ELK class=md-nav__link> ELK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../code/devops/git/git-git/ title=Git class=md-nav__link> Git </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1-5 type=checkbox id=nav-2-1-5> <label class=md-nav__link for=nav-2-1-5> Git Flow </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-1-5> Git Flow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/devops/git/gitflow/gitflow-gitflow/ title="Git Flow" class=md-nav__link> Git Flow </a> </li> <li class=md-nav__item> <a href=../../../code/devops/git/gitflow/gitflow-instalacion/ title="Puesta a punto" class=md-nav__link> Puesta a punto </a> </li> <li class=md-nav__item> <a href=../../../code/devops/git/gitflow/gitflow-comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> IDEs </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> IDEs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/ides/vscode/vscode/ title="Visual Studio code" class=md-nav__link> Visual Studio code </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Python </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-1 type=checkbox id=nav-2-3-1> <label class=md-nav__link for=nav-2-3-1> Entornos virtuales </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-1> Entornos virtuales </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/python/venv/venv-introduccion/ title=Introducción class=md-nav__link> Introducción </a> </li> <li class=md-nav__item> <a href=../../../code/python/venv/venv-virtualenv/ title=virtualenv class=md-nav__link> virtualenv </a> </li> <li class=md-nav__item> <a href=../../../code/python/venv/venv-virtualenvwrapper/ title=virtualenvwrapper class=md-nav__link> virtualenvwrapper </a> </li> <li class=md-nav__item> <a href=../../../code/python/venv/venv-pipenv/ title=pipenv class=md-nav__link> pipenv </a> </li> <li class=md-nav__item> <a href=../../../code/python/venv/venv-pyenv/ title=pyenv class=md-nav__link> pyenv </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../code/python/python-pythonpath/ title=PYTHONPATH class=md-nav__link> PYTHONPATH </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> Web </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/web/frontend/html/html-indice/ title=HTML class=md-nav__link> HTML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1-2 type=checkbox id=nav-2-4-1-2> <label class=md-nav__link for=nav-2-4-1-2> CSS </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-4-1-2> CSS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/web/frontend/css/css-plugins/ title=Plugins class=md-nav__link> Plugins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../code/web/frontend/js/js-indice/ title=JS class=md-nav__link> JS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-2 type=checkbox id=nav-2-4-2> <label class=md-nav__link for=nav-2-4-2> Backend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-2> Backend </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-2-1 type=checkbox id=nav-2-4-2-1> <label class=md-nav__link for=nav-2-4-2-1> Django </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-2-4-2-1> Django </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../code/web/backend/django/django/ title=Django class=md-nav__link> Django </a> </li> <li class=md-nav__item> <a href=../../../code/web/backend/django/django-principiante/ title=Principiante class=md-nav__link> Principiante </a> </li> <li class=md-nav__item> <a href=../../../code/web/backend/django/django-intermedio/ title=Intermedio class=md-nav__link> Intermedio </a> </li> <li class=md-nav__item> <a href=../../../code/web/backend/django/django-avanzado/ title=Avanzado class=md-nav__link> Avanzado </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Software </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Software </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/linux-fecha-hora/ title="Fecha y Hora" class=md-nav__link> Fecha y Hora </a> </li> <li class=md-nav__item> <a href=../../linux/linux-ficheros/ title=Ficheros class=md-nav__link> Ficheros </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2 checked> <label class=md-nav__link for=nav-3-2> Redes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Redes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../redes-linux/ title=Linux class=md-nav__link> Linux </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> SSH </label> <a href=./ title=SSH class="md-nav__link md-nav__link--active"> SSH </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#instalacion-y-configuracion title="Instalación y configuración" class=md-nav__link> Instalación y configuración </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servidor title=Servidor class=md-nav__link> Servidor </a> </li> <li class=md-nav__item> <a href=#cliente title=Cliente class=md-nav__link> Cliente </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#acceso-con-usuario-contrasena title="Acceso con usuario-contraseña" class=md-nav__link> Acceso con usuario-contraseña </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ejecutar-comandos-sin-abrir-una-terminal-remota title="Ejecutar comandos sin abrir una terminal remota" class=md-nav__link> Ejecutar comandos sin abrir una terminal remota </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#acceso-con-par-clave-publico-privada-sin-passphrase title="Acceso con par clave público-privada sin passphrase" class=md-nav__link> Acceso con par clave público-privada sin passphrase </a> </li> <li class=md-nav__item> <a href=#acceso-con-par-publico-privada-con-passphrase title="Acceso con par público-privada con passphrase" class=md-nav__link> Acceso con par público-privada con passphrase </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ssh-agent title=ssh-agent class=md-nav__link> ssh-agent </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#authorized_keys-gestionar-accesos-a-mi-equipo title="authorized_keys -> Gestionar accesos a mi equipo" class=md-nav__link> authorized_keys -&gt; Gestionar accesos a mi equipo </a> </li> <li class=md-nav__item> <a href=#known_hosts-gestionar-equipos-a-los-que-accedo title="known_hosts -> Gestionar equipos a los que accedo" class=md-nav__link> known_hosts -&gt; Gestionar equipos a los que accedo </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problemas-con-acceso-a-la-misma-ip-pero-distintos-hosts title="Problemas con acceso a la misma ip pero distintos hosts" class=md-nav__link> Problemas con acceso a la misma ip pero distintos hosts </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#forwarding title=Forwarding class=md-nav__link> Forwarding </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-forwarding title="Agent Forwarding" class=md-nav__link> Agent Forwarding </a> </li> <li class=md-nav__item> <a href=#x11-forwarding title="X11 Forwarding" class=md-nav__link> X11 Forwarding </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#transferir-ficheros-por-ssh title="Transferir ficheros por SSH" class=md-nav__link> Transferir ficheros por SSH </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scp title=SCP class=md-nav__link> SCP </a> </li> <li class=md-nav__item> <a href=#sftp title=SFTP class=md-nav__link> SFTP </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuneles-ssh title="Túneles SSH" class=md-nav__link> Túneles SSH </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-fordwarding title="Local Fordwarding" class=md-nav__link> Local Fordwarding </a> </li> <li class=md-nav__item> <a href=#remote-forwarding title="Remote Forwarding" class=md-nav__link> Remote Forwarding </a> </li> <li class=md-nav__item> <a href=#dynamic-fordwarding title="Dynamic Fordwarding" class=md-nav__link> Dynamic Fordwarding </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conexion-a-github-con-par-clave-publico-privada title="Conexión a Github con par clave público-privada" class=md-nav__link> Conexión a Github con par clave público-privada </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../redes-iptables/ title=iptables class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=../redes-ipv6/ title=IPv6 class=md-nav__link> IPv6 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Terminal </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Terminal </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terminal/terminal-bash/ title=Bash class=md-nav__link> Bash </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3-2 type=checkbox id=nav-3-3-2> <label class=md-nav__link for=nav-3-3-2> tmux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-3-2> tmux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terminal/tmux/tmux-comandos/ title=Comandos class=md-nav__link> Comandos </a> </li> <li class=md-nav__item> <a href=../../terminal/tmux/tmux-customizar/ title=Customización class=md-nav__link> Customización </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../terminal/terminal-zsh/ title=ZSH class=md-nav__link> ZSH </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Hardware </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../hw/upython/upython-informacion/ title=Micropython class=md-nav__link> Micropython </a> </li> <li class=md-nav__item> <a href=../../../hw/pio/pio-informacion/ title=Platformio class=md-nav__link> Platformio </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> IoT </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> IoT </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> MQTT </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> MQTT </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../iot/mqtt/mqtt/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../../../iot/mqtt/mqtt-hello-world/ title="Hola mundo" class=md-nav__link> Hola mundo </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#instalacion-y-configuracion title="Instalación y configuración" class=md-nav__link> Instalación y configuración </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servidor title=Servidor class=md-nav__link> Servidor </a> </li> <li class=md-nav__item> <a href=#cliente title=Cliente class=md-nav__link> Cliente </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#acceso-con-usuario-contrasena title="Acceso con usuario-contraseña" class=md-nav__link> Acceso con usuario-contraseña </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ejecutar-comandos-sin-abrir-una-terminal-remota title="Ejecutar comandos sin abrir una terminal remota" class=md-nav__link> Ejecutar comandos sin abrir una terminal remota </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#acceso-con-par-clave-publico-privada-sin-passphrase title="Acceso con par clave público-privada sin passphrase" class=md-nav__link> Acceso con par clave público-privada sin passphrase </a> </li> <li class=md-nav__item> <a href=#acceso-con-par-publico-privada-con-passphrase title="Acceso con par público-privada con passphrase" class=md-nav__link> Acceso con par público-privada con passphrase </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ssh-agent title=ssh-agent class=md-nav__link> ssh-agent </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#authorized_keys-gestionar-accesos-a-mi-equipo title="authorized_keys -> Gestionar accesos a mi equipo" class=md-nav__link> authorized_keys -&gt; Gestionar accesos a mi equipo </a> </li> <li class=md-nav__item> <a href=#known_hosts-gestionar-equipos-a-los-que-accedo title="known_hosts -> Gestionar equipos a los que accedo" class=md-nav__link> known_hosts -&gt; Gestionar equipos a los que accedo </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problemas-con-acceso-a-la-misma-ip-pero-distintos-hosts title="Problemas con acceso a la misma ip pero distintos hosts" class=md-nav__link> Problemas con acceso a la misma ip pero distintos hosts </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#forwarding title=Forwarding class=md-nav__link> Forwarding </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-forwarding title="Agent Forwarding" class=md-nav__link> Agent Forwarding </a> </li> <li class=md-nav__item> <a href=#x11-forwarding title="X11 Forwarding" class=md-nav__link> X11 Forwarding </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#transferir-ficheros-por-ssh title="Transferir ficheros por SSH" class=md-nav__link> Transferir ficheros por SSH </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scp title=SCP class=md-nav__link> SCP </a> </li> <li class=md-nav__item> <a href=#sftp title=SFTP class=md-nav__link> SFTP </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuneles-ssh title="Túneles SSH" class=md-nav__link> Túneles SSH </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-fordwarding title="Local Fordwarding" class=md-nav__link> Local Fordwarding </a> </li> <li class=md-nav__item> <a href=#remote-forwarding title="Remote Forwarding" class=md-nav__link> Remote Forwarding </a> </li> <li class=md-nav__item> <a href=#dynamic-fordwarding title="Dynamic Fordwarding" class=md-nav__link> Dynamic Fordwarding </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conexion-a-github-con-par-clave-publico-privada title="Conexión a Github con par clave público-privada" class=md-nav__link> Conexión a Github con par clave público-privada </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=ssh>SSH<a class=headerlink href=#ssh title="Permanent link">&para;</a></h1> <h2 id=instalacion-y-configuracion>Instalación y configuración<a class=headerlink href=#instalacion-y-configuracion title="Permanent link">&para;</a></h2> <h3 id=servidor>Servidor<a class=headerlink href=#servidor title="Permanent link">&para;</a></h3> <p>Instalación</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>sudo apt install openssh-server
</pre></div> </td></tr></table> <p>Esto genera 4 pares de ficheros de clave pública-privada en el servidor con 4 algoritmos de cifrado:</p> <table> <thead> <tr> <th align=center>Algoritmo</th> <th align=center>Fichero Clave Privada</th> <th align=center>Fichero Clave Pública</th> </tr> </thead> <tbody> <tr> <td align=center>DSA</td> <td align=center>ssh_host_dsa_key</td> <td align=center>ssh_host_dsa_key.pub</td> </tr> <tr> <td align=center>ECDSA</td> <td align=center>ssh_host_ecdsa_key</td> <td align=center>ssh_host_ecdsa_key.pub</td> </tr> <tr> <td align=center>ED25519</td> <td align=center>ssh_host_ed25519_key</td> <td align=center>ssh_host_ed25519_key.pub</td> </tr> <tr> <td align=center>RSA</td> <td align=center>ssh_host_rsa_key</td> <td align=center>ssh_host_rsa_key.pub</td> </tr> </tbody> </table> <p>Configuración en <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>sshd_config</span></code>.</p> <p>Una buena práctica es configurar que el acceso por <strong>root</strong> solo se haga a través de clave pública con</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>PermitRootLogin without-password
</pre></div> </td></tr></table> <h3 id=cliente>Cliente<a class=headerlink href=#cliente title="Permanent link">&para;</a></h3> <p>Instalación</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>sudo apt install openssh-client
</pre></div> </td></tr></table> <p>Configuración en <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>ssh_config</span></code> </p> <h2 id=acceso-con-usuario-contrasena>Acceso con usuario-contraseña<a class=headerlink href=#acceso-con-usuario-contrasena title="Permanent link">&para;</a></h2> <p>Lo típico para iniciar sesión en SSH es usar las credenciales del usuario y contraseña</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh &lt;usuario&gt;@&lt;ip&gt;
</pre></div> </td></tr></table> <p>O también se puede usar </p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -l &lt;usuarios&gt; &lt;ip&gt;
</pre></div> </td></tr></table> <p>Luego nos pedirá la contraseña, y la primera vez nos pedirá aceptar la conexión.</p> <h3 id=ejecutar-comandos-sin-abrir-una-terminal-remota>Ejecutar comandos sin abrir una terminal remota<a class=headerlink href=#ejecutar-comandos-sin-abrir-una-terminal-remota title="Permanent link">&para;</a></h3> <p>También se pueden ejecutar comandos o scripts sin abrir una consola remota</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh &lt;user&gt;@&lt;ip&gt; &lt;comando&gt;
ssh &lt;user&gt;@&lt;ip&gt; <span class=s1>&#39;&lt;script&gt;&#39;</span>
</pre></div> </td></tr></table> <h2 id=acceso-con-par-clave-publico-privada-sin-passphrase>Acceso con par clave público-privada sin passphrase<a class=headerlink href=#acceso-con-par-clave-publico-privada-sin-passphrase title="Permanent link">&para;</a></h2> <p>Lo lógico en SSH es usar el par claves público-privada para acceder por SSH, y no tener que estar poniendo usuario-contraseña cada vez que queremos acceder (a parte de que es menos inseguro).</p> <ol> <li> <p>Crear par de clave privada-pública (en el equipo local):</p> <ul> <li>Para crear el par de claves usamos el comando</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-keygen -t &lt;algoritmo&gt;
</pre></div> </td></tr></table> <ul> <li><code class=codehilite><span class=o>&lt;</span><span class=n>algortimo</span><span class=o>&gt;</span></code> -&gt; <code class=codehilite><span class=n>dsa</span></code> | <code class=codehilite><span class=n>ed25519</span></code> | <code class=codehilite><span class=n>rsa</span></code> | <code class=codehilite><span class=n>rsa1</span></code></li> <li>Saldrá un diálogo y nos pedirá el nombre para el fichero.</li> <li>También nos pedirá un <code class=codehilite><span class=n>passphrase</span></code> (frase de paso), que es opcional, lo dejamos en blanco.</li> <li>Esto lo vemos en la siguiente sección.</li> <li>Esto generará dos ficheros, por ejemplo si usamos rsa y el nombre por defecto, tendremos:</li> <li>En <strong>~/.ssh/</strong> los ficheros de claves.</li> <li><strong>id_rsa</strong> clave privada.</li> <li><strong>id_rsa.pub</strong> clave pública.</li> </ul> </li> <li> <p>Copiar clave pública (en el equipo remoto):</p> <ul> <li>Para poder acceder con este método, hay que "publicar" la clave pública en el equipo remoto.</li> <li>Esto consiste en meter la clave pública en el fichero <strong>~/.ssh/authorized_keys</strong> del equipo remoto.</li> <li>Hay varios métodos pero el más sencillo es con el comando</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-copy-id -i &lt;ruta al fichero de clave privada&gt; &lt;usuario&gt;@&lt;ip&gt;
</pre></div> </td></tr></table> <ul> <li>Por ejemplo, si queremos copiar nuestra rsa clave que está en <strong>~/.ssh/</strong> en el equipo con usuario <strong>pepe</strong> con la ip <strong>192.168.1.13</strong> haremos </li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-copy-id -i ~/.ssh/id_rsa pepe@192.168.1.13
</pre></div> </td></tr></table> </li> </ol> <p>Ahora para acceder no nos pedirá contraseña.<br> Ventajas:</p> <ul> <li>Es más seguro</li> <li>Si se cambia el password del usuario, nosotros no necesitaremos saberlo (no nos afecta).</li> </ul> <h2 id=acceso-con-par-publico-privada-con-passphrase>Acceso con par público-privada con passphrase<a class=headerlink href=#acceso-con-par-publico-privada-con-passphrase title="Permanent link">&para;</a></h2> <p>El passphrase es un second factor authentication. Si añadimos una passphrase a nuestro par de claves, al acceder por ssh nos la pedirá, como cuando accedemos por usuario y la contraseña.</p> <p>Ventajas:</p> <ul> <li>Es más seguro.</li> <li>Si alguien nos roba la clave privada, no podrá usarla si no sabe la passphrase.</li> </ul> <p>Para que sea más cómodo esto, usamos el programa <strong>ssh-agent</strong>, y así solo tendremos que poner el passphrase la primera vez y ya está.</p> <h3 id=ssh-agent>ssh-agent<a class=headerlink href=#ssh-agent title="Permanent link">&para;</a></h3> <p>El programa / servicio <code class=codehilite><span class=n>ssh</span><span class=o>-</span><span class=n>agent</span></code> nos permite no tener que estar introduciendo la passphrase cada vez que nos conectemos. Lo ponemos una vez y listo. Los pasos para que todo esto funcionen son:</p> <ol> <li> <p>Comprobamos que esté ejecutando ssh-agent</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ps aux <span class=p>|</span> grep ssh-agent
</pre></div> </td></tr></table> <ul> <li>Si no se está ejecutando lo activamos con</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-agent /bin/bash
</pre></div> </td></tr></table> </li> <li> <p>Una vez se está ejecutando, se añade la clave privada</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add &lt;ruta fichero clave privada&gt;
</pre></div> </td></tr></table> <ul> <li>Por ejemplo</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add ~/.ssh/id_rsa
</pre></div> </td></tr></table> </li> <li> <p>Utilidades de <strong>ssh-agent</strong>:</p> <ul> <li>Ver las claves cargadas</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add -L
</pre></div> </td></tr></table> <ul> <li>Ver sus huellas</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add -l
</pre></div> </td></tr></table> <ul> <li>Para eliminar una clave</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add -d &lt;fichero-clave-privada&gt;
</pre></div> </td></tr></table> <ul> <li>Eliminar todas las claves</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add -D
</pre></div> </td></tr></table> </li> <li> <p>Crear clave pública (si no existe) desde la clave privada</p> <ul> <li>Supongamos que por lo que sea solo tenemos una clave privada y queremos generar la pública</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-keygen -y -f &lt;fichero clave privada&gt; &gt;&gt; &lt;fichero clave pública&gt;
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=o>*</span> <span class=n>Por</span> <span class=n>ejemplo</span>

  <span class=o>```</span><span class=n>bash</span>
  <span class=n>ssh</span><span class=o>-</span><span class=n>keygen</span> <span class=o>-</span><span class=n>y</span> <span class=o>-</span><span class=n>f</span> <span class=n>id_rsa</span> <span class=o>&gt;&gt;</span> <span class=n>id_rsa</span><span class=p>.</span><span class=n>pub</span>
  <span class=o>```</span>
</pre></div> </td></tr></table> <ul> <li>El proceso inverso, sacar la privada de la pública, no es posible.</li> </ul> </li> </ol> <h2 id=authorized_keys-gestionar-accesos-a-mi-equipo>authorized_keys -&gt; Gestionar accesos a mi equipo<a class=headerlink href=#authorized_keys-gestionar-accesos-a-mi-equipo title="Permanent link">&para;</a></h2> <p>El servidor SSH guarda las claves públicas autorizadas para que puedan en el fichero <code class=codehilite><span class=o>~/</span><span class=p>.</span><span class=n>ssh</span><span class=o>/</span><span class=n>authorized_keys</span></code>. Si quisiera que una clave pública no se pudiera usar para acceder en mi servidor, la borro de ese fichero.</p> <p>El formato que tiene cada línea es</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>&lt;tipo-clave&gt; &lt;clave-pública-cliente&gt; &lt;comentario&gt;
</pre></div> </td></tr></table> <p>El <code class=codehilite><span class=o>&lt;</span><span class=n>tipo</span><span class=o>-</span><span class=n>clave</span><span class=o>&gt;</span></code> me dice el algoritmo con el que se ha creado.<br> La <code class=codehilite><span class=o>&lt;</span><span class=n>clave</span><span class=o>-</span><span class=n>publica</span><span class=o>-</span><span class=n>cliente</span><span class=o>&gt;</span></code> es la clave del cliente que se va a conectar a mi equipo.<br> El <code class=codehilite><span class=o>&lt;</span><span class=n>comentario</span><span class=o>&gt;</span></code> suele ser el <code class=codehilite><span class=o>&lt;</span><span class=n>usuario</span><span class=o>&gt;@&lt;</span><span class=n>equipo</span><span class=o>&gt;</span></code>.</p> <h2 id=known_hosts-gestionar-equipos-a-los-que-accedo>known_hosts -&gt; Gestionar equipos a los que accedo<a class=headerlink href=#known_hosts-gestionar-equipos-a-los-que-accedo title="Permanent link">&para;</a></h2> <p>El cliente tiene un control de todos los servidores SSH a los que se conecta. Esto lo hace guardando las claves públicas de los servidores en el fichero <code class=codehilite><span class=o>~/</span><span class=p>.</span><span class=n>ssh</span><span class=o>/</span><span class=n>known_hosts</span></code>.</p> <p>Tiene 3 campos</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>&lt;hash-ip-equipo-remoto&gt; &lt;tipo-clave&gt; &lt;clave-publica-servidor&gt;
</pre></div> </td></tr></table> <h3 id=problemas-con-acceso-a-la-misma-ip-pero-distintos-hosts>Problemas con acceso a la misma ip pero distintos hosts<a class=headerlink href=#problemas-con-acceso-a-la-misma-ip-pero-distintos-hosts title="Permanent link">&para;</a></h3> <p>Supongamos que yo tenía un pc al que accedía con la ip <code class=codehilite><span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>120</span></code>. Por lo que sea, he formateado y trato de volver a acceder a esa máquina formateada. Lo más seguro es que me salga un mensaje de error diciendome que el <strong>remote host</strong> ha cambiado (del que yo tenía guardado), y puedo sufrir un ataque <strong>man-in-the-middle</strong>. Si estamos completamente seguros que no hay nadie en medio, y accedo directamente a mi máquina, l que debemos hacer es borrar el <code class=codehilite><span class=n>known_hosts</span></code> el anterior equipo. Tranquilos, que el propio comando te lo dan en el mensaje de ayuda, solo hay que hacer copia-pega. El comando es así:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-keygen <span class=o>[</span>-f <span class=s2>&quot;&lt;path-to-known_hosts&gt;&quot;</span><span class=o>]</span> -R &lt;ip&gt;
</pre></div> </td></tr></table> <p>En nuestro caso sería <code class=codehilite><span class=n>ssh</span><span class=o>-</span><span class=n>keygen</span> <span class=o>-</span><span class=n>f</span> <span class=ss>&quot;~/.ssh/known_hosts&quot;</span> <span class=o>-</span><span class=n>R</span> <span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>120</span></code>. La parte de <code class=codehilite><span class=o>-</span><span class=n>f</span> <span class=ss>&quot;~/.ssh/known_hosts&quot;</span></code> es opcional, podríamos hacer <code class=codehilite><span class=n>ssh</span><span class=o>-</span><span class=n>keygen</span> <span class=o>-</span><span class=n>R</span> <span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>120</span></code> y sería totalmente válido.</p> <h2 id=forwarding>Forwarding<a class=headerlink href=#forwarding title="Permanent link">&para;</a></h2> <p>Esta técnica permite reenviar "algo", desde un equipo al otro, pasando por otro.</p> <h3 id=agent-forwarding>Agent Forwarding<a class=headerlink href=#agent-forwarding title="Permanent link">&para;</a></h3> <p>Imaginemos que existen 3 máquinas, A, B, C, y tenemos el siguiente problema:</p> <ul> <li>A &lt;-&gt; B = A y B se pueden comunicar por SSH.</li> <li>B &lt;-&gt; C = B y C se pueden comunicar por SSH.</li> <li>A C = A y C no se pueden comunicar por SSH.</li> </ul> <p>Agent forwarding nos permite que A &lt;-&gt; C a través de B, es decir A &lt;-B-&gt; C.</p> <p>Esto es posible haciendo:</p> <ol> <li> <p>Activando en el servidor de B <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>sshd_config</span></code> la opción</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>AllowAgentForwarding yes
</pre></div> </td></tr></table> </li> <li> <p>Activando en el agente / cliente de B <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>ssh_config</span></code> la opción</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ForwardAgent yes
</pre></div> </td></tr></table> </li> </ol> <p>Así ahora, para hacer A &lt;-&gt; C, lo que haría es:</p> <ol> <li>Accedo desde A por SSH a B = A -&gt; B.</li> <li>Accedo desde B por SSH a C = B -&gt; C.</li> </ol> <p>Y ahora en la shell veré que estoy en C. Parece obvio, pero si estas opciones no están activadas, no se podría hacer.</p> <p>La idea al final de todo esto, es que si tengo muchas máquinas C's: C1, C2, C3, etc. Es recomendable que no estén expuestas al exterior. Lo mejor es tener un "bastión", es decir, una máquina B, que está autenticada con claves publico-privada + passphrase con cada Cx, y yo desde A solo tengo acceso a B.</p> <h3 id=x11-forwarding>X11 Forwarding<a class=headerlink href=#x11-forwarding title="Permanent link">&para;</a></h3> <p>Si accedo por SSH de una máquina A a otra B, A -&gt; B, y ejecuto una aplicación gráfica (X11), no la veo en mi equipo A, solo se ve en el equipo B. La forma de poder ver en A una app X11 ejecutada en B es con la técnica X11 forwarding. Para poder aplicar esta técnica tengo que:</p> <ul> <li> <p>Habilitar en el servidor de B <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>sshd_config</span></code> las opciones</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span>X11Forwarding yes
X11DisplayOffset <span class=m>10</span>
</pre></div> </td></tr></table> </li> </ul> <p>Si lo que quiero es ejecutar una aplicación gráfica de C en mi máquina A, debo de:</p> <ul> <li> <p>Habilitar en el cliente/agente de B <code class=codehilite><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>ssh_config</span></code> la opción</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>FordwardX11 yes
</pre></div> </td></tr></table> </li> </ul> <p>Al ejecutar una app X11 remota, aunque la vea en mi equipo local, los recursos que consume son de la máquina remota.</p> <h2 id=transferir-ficheros-por-ssh>Transferir ficheros por SSH<a class=headerlink href=#transferir-ficheros-por-ssh title="Permanent link">&para;</a></h2> <p>SSH no solo permite iniciar sesiones o ejecutar comandos en remoto. También permite la transferencia de ficheros a través de dos protocolos, SCP y SFTP.</p> <h3 id=scp>SCP<a class=headerlink href=#scp title="Permanent link">&para;</a></h3> <p>SCP es un protocolo que se puede usar con SSH para poder compartir ficheros. Su sintaxis es similar a la <code class=codehilite><span class=n>cp</span></code>, pero "generalizada"</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp <span class=o>[[</span>&lt;usuario-origen&gt;@<span class=o>]</span>&lt;host-origen&gt;:<span class=o>]</span>&lt;fichero-origen&gt; <span class=o>[[</span>&lt;usuario-destino&gt;@<span class=o>]</span>&lt;host-destino&gt;:<span class=o>]</span>&lt;fichero-destino&gt;
scp -r <span class=o>[[</span>&lt;usuario-origen&gt;@<span class=o>]</span>&lt;host-origen&gt;:<span class=o>]</span>&lt;directorio-origen&gt; <span class=o>[[</span>&lt;usuario-destino&gt;@<span class=o>]</span>&lt;host-destino&gt;:<span class=o>]</span>&lt;directorio-destino&gt;
</pre></div> </td></tr></table> <p>Visto así es muy lioso, vamos a verlo con ejemplos.</p> <table> <thead> <tr> <th align=center>Máquina</th> <th align=center>Usuario</th> <th align=center>Host</th> </tr> </thead> <tbody> <tr> <td align=center>A</td> <td align=center>usera</td> <td align=center>192.168.1.120</td> </tr> <tr> <td align=center>B</td> <td align=center>userb</td> <td align=center>192.168.1.121</td> </tr> <tr> <td align=center>C</td> <td align=center>userc</td> <td align=center>192.168.1.122</td> </tr> </tbody> </table> <p>En todos los ejemplos voy a suponer que estoy en la máquina A:</p> <ul> <li>Pasar fichero <code class=codehilite><span class=n>mifichero</span><span class=p>.</span><span class=n>txt</span></code> en el <code class=codehilite><span class=err>$</span><span class=n>HOME</span></code> origen, a la carpeta <code class=codehilite><span class=n>micarpeta</span></code> del <code class=codehilite><span class=err>$</span><span class=n>HOME</span></code> destino</li> <li> <p>A -&gt; B (de local a remoto)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp <span class=nv>$HOME</span>/mifichero.txt userb@192.168.1.121:<span class=nv>$HOME</span>/micarpeta/
</pre></div> </td></tr></table> </li> <li> <p>B -&gt; A (de remoto a local)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp userb@192.168.121:<span class=nv>$HOME</span>/fichero.txt <span class=nv>$HOME</span>/micarpeta/
</pre></div> </td></tr></table> </li> <li> <p>B -&gt; C (de remoto a remoto)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp userb@192.168.1.121:<span class=nv>$HOME</span>/fichero.txt userc@192.168.1.122:<span class=nv>$HOME</span>/micarpeta/
</pre></div> </td></tr></table> </li> <li> <p>Pasar la carpeta <code class=codehilite><span class=n>micarpeta</span></code> del <code class=codehilite><span class=err>$</span><span class=n>HOME</span></code> origen al <code class=codehilite><span class=err>$</span><span class=n>HOME</span></code> destino</p> </li> <li> <p>A -&gt; B (de local a remoto)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp -r <span class=nv>$HOME</span>/micarpeta userb@192.168.1.121:<span class=nv>$HOME</span>/
</pre></div> </td></tr></table> </li> <li> <p>B -&gt; A (de remoto a local)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp -r userb@192.168.1.121:<span class=nv>$HOME</span>/micarpeta <span class=nv>$HOME</span>/
</pre></div> </td></tr></table> </li> <li> <p>B -&gt; C (de remoto a remoto)</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>scp -r userb@192.168.1.121:<span class=nv>$HOME</span>/micarpeta userc@192.168.1.122:<span class=nv>$HOME</span>/
</pre></div> </td></tr></table> </li> </ul> <h3 id=sftp>SFTP<a class=headerlink href=#sftp title="Permanent link">&para;</a></h3> <p>SFTP es SSH FTP, es decir, una comunicación FTP sobre SSH. No confundir con FTPS, que es una variación de FTP securizada. Para usarla hacemos</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>sftp &lt;usuario&gt;@&lt;host&gt;
</pre></div> </td></tr></table> <p>Se nos abrirá una shell que podemos usar como si fuera una shell FTP. También podemos abrir una conexión SFTP desde cualquier programa FTP cliente como Filezilla</p> <h2 id=tuneles-ssh>Túneles SSH<a class=headerlink href=#tuneles-ssh title="Permanent link">&para;</a></h2> <p>Esto se conoce como Port Fordwarding o TCP Fordwarding. Supongamos que tenemos:</p> <table> <thead> <tr> <th align=center>Maquina</th> <th align=center>Usuario</th> <th align=center>Host</th> <th align=center>Puerto</th> <th align=center>SSH</th> </tr> </thead> <tbody> <tr> <td align=center>A</td> <td align=center>usera</td> <td align=center>hosta</td> <td align=center>porta</td> <td align=center>A&lt;-&gt;B</td> </tr> <tr> <td align=center>B</td> <td align=center>userb</td> <td align=center>hostb</td> <td align=center>portb</td> <td align=center>B&lt;-&gt;A, B&lt;-&gt;C</td> </tr> <tr> <td align=center>C</td> <td align=center>userc</td> <td align=center>hostc</td> <td align=center>portc</td> <td align=center>C&lt;-&gt;B</td> </tr> </tbody> </table> <p>Con este escenario, tenemos 3 tipos de túneles:</p> <ul> <li>Local Fordwarding (-L): Traer un puerto (servicio) remoto (de A ó C) a uno local (de C ó A) por B.</li> <li>Remote Fordwarding (-R): Enviar un puerto (servicio) local (de A ó C) a uno remoto (de C ó A) por B.</li> <li>Dynamic Fordwarding (-D): ni idea</li> </ul> <p>Básicamente consiste en traer / enviar un puerto local / remoto desde una máquina a otra, pasando por una máquina intermedia.</p> <h3 id=local-fordwarding>Local Fordwarding<a class=headerlink href=#local-fordwarding title="Permanent link">&para;</a></h3> <p>Local Fordwarding consiste en traer un puerto remoto (de otra máquina) a un puerto de mi máquina local. Es decir, es como si desde mi puerto local estuviera en el puerto remoto de la otra máquina.</p> <p>Comando y variantes:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -N -L <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt;:&lt;host&gt;:&lt;host-port&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -L <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt;:&lt;remote-socket&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -L &lt;local-socket&gt;:&lt;host&gt;:&lt;host-port&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -L &lt;local-socket&gt;:&lt;remote-socket&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
</pre></div> </td></tr></table> <p>Supongamos que A con acceso libre a Internet, y C con acceso restringido Internet (no puede acceder a ciertos servicios / web). Así que nos interesaría:</p> <ul> <li> <p>Desde C, traer hosta:porta a hostc:portc, por B</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -NL portc:hosta:porta userb@hostb
</pre></div> </td></tr></table> </li> </ul> <p>Ahora supongamos que C tiene un servicio NGINX en su puerto 80, y lo queremos poder consumir:</p> <ul> <li> <p>Desde A, traer el puerto 80 de C al puerto 1080 de A, por B</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -NL <span class=m>1080</span>:hostc:80 userb@hostb
</pre></div> </td></tr></table> </li> <li> <p>También podríamos hacer:</p> </li> <li> <p>Desde B, traer el pierto de C al puerto 1080 de B</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -NL
</pre></div> </td></tr></table> </li> <li> <p>Desde A, consumir ese NGINX accediendo en el navegador a <code class=codehilite><span class=n>hostb</span><span class=o>:</span><span class=mi>1080</span></code></p> </li> </ul> <h3 id=remote-forwarding>Remote Forwarding<a class=headerlink href=#remote-forwarding title="Permanent link">&para;</a></h3> <p>Remote Fordwarding consiste en enviar un puerto local (de mi máquina) a un puerto de una máquina remota. Es decir, es como si desde un puerto de una máquina remota estuviera en el puerto de mi máquina local.</p> <p>Comando y sus variantes:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -N -R <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt;:&lt;host&gt;:&lt;host-port&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -R <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt;:&lt;local-socket&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -R &lt;remote-socket&gt;:&lt;host&gt;:&lt;host-port&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -R &lt;remote-socket&gt;:&lt;local-socket&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
ssh -f -N -R <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt; <span class=o>[</span>&lt;user&gt;@&lt;host&gt;<span class=o>]</span>
</pre></div> </td></tr></table> <p>Supongamos que </p> <h3 id=dynamic-fordwarding>Dynamic Fordwarding<a class=headerlink href=#dynamic-fordwarding title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh -f -N -D <span class=o>[</span>&lt;bind-address&gt;:<span class=o>]</span>&lt;port&gt;
</pre></div> </td></tr></table> <h2 id=conexion-a-github-con-par-clave-publico-privada>Conexión a Github con par clave público-privada<a class=headerlink href=#conexion-a-github-con-par-clave-publico-privada title="Permanent link">&para;</a></h2> <ol> <li> <p>Generar par de claves con passphrase mediante</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-keygen -t rsa -b <span class=m>4096</span> -C <span class=s2>&quot;&lt;github email&gt;&quot;</span>
</pre></div> </td></tr></table> </li> <li> <p>Añadir la clave al ssh-agent </p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>ssh-add -K &lt;ruta al fichero de clave privada&gt;
</pre></div> </td></tr></table> </li> <li> <p>Añadir la clave pública en Github</p> </li> <li> <p>Copiar la clave pública en el clipboard</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>pbcopy &lt; &lt;ruta al fichero de clave pública&gt;
</pre></div> </td></tr></table> </li> <li> <p>Pegar la clave pública en Github</p> <ol> <li>Ir a <strong>Settings</strong> -&gt; <strong>SSH and GPG Keys</strong> -&gt; <strong>New SSH</strong> or <strong>Add SSH Key</strong></li> <li>Poner un título para que se entienda de que equipo es la clave y pegar la clave en el campo <strong>Key</strong></li> <li>Por último, darle al botón <strong>Add SSH key</strong>, confirmar y listo.</li> </ol> </li> </ol> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../redes-linux/ title=Linux class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Anterior </span> Linux </span> </div> </a> <a href=../redes-iptables/ title=iptables class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Siguiente </span> iptables </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Cristóbal Contreras </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/crisconru class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/crisconru class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/cristobalcontrerasrubio class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.245445c6.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/lunr.es.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>